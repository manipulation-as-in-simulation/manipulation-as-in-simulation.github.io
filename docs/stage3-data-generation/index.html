<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Stage 3: Data Generation - ManipAsInSim's Sim-to-Real Tutorial</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.6.1, mkdocs-gitbook-1.0.7">
<meta name="author" content="ManipAsInSim Team">
<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet">
<link href="../assets/_mkdocstrings.css" rel="stylesheet">
<link href="../custom.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".."  class="custom-link">ManipAsInSim's Sim-to-Real Tutorial</a>
</li>
<li class="divider"></li>
<li class="header"><a href="../stage1-task-scene-construction/index.html" class="">Stage 1 - Task and Scene Construction</a></li>

<li>
<a href="../stage1-task-scene-construction#overview" class="">Overview</a>
</li>

<li>
<a href="../stage1-task-scene-construction#kitchen-task-example" class="">Kitchen Task Example</a>
</li>

<li>
<a href="../stage1-task-scene-construction#canteen-task-example" class="">Canteen Task Example</a>
</li>

<li>
<a href="../stage1-task-scene-construction#code-reference" class="">Code Reference</a>
</li>

<li>
<a href="../stage1-task-scene-construction#next-steps" class="">Next Steps</a>
</li>

<li class="header"><a href="../stage2-calibration/index.html" class="">Stage 2 - Camera Calibration</a></li>

<li>
<a href="../stage2-calibration#overview" class="">Overview</a>
</li>

<li>
<a href="../stage2-calibration#calibration-workflow" class="">Calibration Workflow</a>
</li>

<li>
<a href="../stage2-calibration#advanced-techniques" class="">Advanced Techniques</a>
</li>

<li>
<a href="../stage2-calibration#code-reference" class="">Code Reference</a>
</li>

<li>
<a href="../stage2-calibration#calibration-data-management" class="">Calibration Data Management</a>
</li>

<li>
<a href="../stage2-calibration#next-steps" class="">Next Steps</a>
</li>

<li class="header"><a href="../stage3-data-generation/index.html">Stage 3 - Data Generation</a></li>

<li>
<a href="../stage3-data-generation#overview" class="">Overview</a>
</li>

<li>
<a href="../stage3-data-generation#data-collection" class="">Data Collection</a>
</li>

<li class="subheader">
<a href="../stage3-data-generation#task-decomposition-and-annotation" class="">Task Decomposition and Annotation</a>
</li>

<li class="subitem">
<a href="../stage3-data-generation#object-centric-decomposition" class="">Object-Centric Decomposition</a>
</li>

<li class="subheader">
<a href="../stage3-data-generation#compare-with-mimicgen" class="">Compare with MimicGen</a>
</li>

<li class="subitem">
<a href="../stage3-data-generation#data-generation-of-mobile-manipulator" class="">Data Generation of Mobile Manipulator</a>
</li>

<li>
<a href="../stage3-data-generation#large-scale-data-generation" class="">Large-scale Data Generation</a>
</li>

<li class="subheader">
<a href="../stage3-data-generation#dataset-management" class="">Dataset Management</a>
</li>

<li class="subitem">
<a href="../stage3-data-generation#data-format" class="">Data Format</a>
</li>

<li>
<a href="../stage3-data-generation#code-reference" class="">Code Reference</a>
</li>

<li>
<a href="../stage3-data-generation#next-steps" class="">Next Steps</a>
</li>

<li class="header"><a href="../stage4-imitation-learning-deployment/index.html" class="">Stage 4 - Imitation Learning and Deployment</a></li>

<li>
<a href="../stage4-imitation-learning-deployment#overview" class="">Overview</a>
</li>

<li>
<a href="../stage4-imitation-learning-deployment#policy-training" class="">Policy Training</a>
</li>

<li>
<a href="../stage4-imitation-learning-deployment#real-world-deployment" class="">Real-World Deployment</a>
</li>

<li>
<a href="../stage4-imitation-learning-deployment#code-reference" class="">Code Reference</a>
</li>

<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="stage-3-data-generation">Stage 3: Data Generation with WBCMimicGen<a class="headerlink" href="#stage-3-data-generation" title="Permanent link"></a></h1>
<h2 id="overview" style="margin: 10px 0; padding: 0px">Overview<a class="headerlink" href="#overview" title="Permanent link"></a></h2>

<div style="margin: 0px 0; padding: 0px; background: linear-gradient(to right, #f8f9fa, #ffffff); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
  <div style="position: relative; width: 100%; max-width: 1200px; margin: 0 auto; overflow-x: auto;">
  <img src="../images/stage-pictures/cdm-pipeline-seq-stage-3.png" alt="ManipAsInSim Pipeline Overview" style="width: 100%; height: auto; display: block; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
  </div>
</div>

<p>Multiple approaches exist for generating manipulation data, including motion planning, reinforcement learning, MimicGen-based methods and so on. Motion planing is more suitable for atomic tasks implementation and implement the code manually for complex tasks is quite time-consuming, while reinforcement learning is more suitable for quite complex tasks (like extreme finegrained control, high dynamic tasks, etc), but reward shaping is also of difficulty. MimicGen-based methods leverages human intuition for complex contact-rich tasks while achieving the scale needed for effective learning. And we think it's better for long-horizon complex tasks. But we found teleoperating in the simulator easily leads to jerky motions, so we enhanced the MimicGen-based methods with Whole Body Control (WBC) - WBCMimicGen. What's more, WBCMimicGen also enables controlling the multi-arm with a mobile base together.</p>
<p>WBCMimicGen decomposes trajectories into object-centric subtasks, applies spatial and temporal transformations based on object relationships, and recombines them to generate diverse training scenarios while maintaining task validity and physical plausibility. Taking the canteen cleaning task as an example, from just 3-5 human demonstrations of plate manipulation, we can generate thousands of variants with different plate positions, approach angles, and cleaning sequences.</p>
<!-- ## Teleoperation System

### Hardware Configuration

Teleoperation system setup:

1. **Input Devices**

   - Meta Quest: Immersive VR control
   - Keyboard: Mode switching

2. **Feedback System**

   - Visual feedback: Multi-view real-time rendering


![Image #1](images/00ffea.png) -->

<h2 id="data-collection">Data Collection<a class="headerlink" href="#data-collection" title="Permanent link"></a></h2>
<ol>
<li>
<p><strong>Task Demonstration</strong></p>
<ul>
<li>Execute task demonstrations by tele-operating</li>
<li>Record complete trajectories</li>
<li>Validate data quality</li>
</ul>
</li>
<li>
<p><strong>Data Recording</strong></p>
<ul>
<li>Robot states (joint angles, end-effector positions)</li>
<li>Environmental observations (RGB images, depth maps, point clouds)</li>
<li>Action commands (control signals, gripper states)</li>
<li>Timestamps and metadata</li>
</ul>
</li>
</ol>
<p><img alt="Image #1" src="../images/00ffea.png" /></p>
<blockquote>
<p>A demo of collected data:</p>
</blockquote>
<div style="display: flex; gap: 20px; width: 100%;">
    <div style="flex: 1;">
      <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
        <source src="../videos/sim/clean_plate/episode_0_camera_0.mp4" type="video/mp4">
      </video>
    </div>
    <div style="flex: 1;">
      <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
        <source src="../videos/sim/microwave_source_demo/episode_0_camera_0.mp4" type="video/mp4">
      </video>
    </div>
  </div>

<h2 id="task-decomposition-and-annotation">Task Decomposition and Annotation<a class="headerlink" href="#task-decomposition-and-annotation" title="Permanent link"></a></h2>
<h3 id="object-centric-decomposition">Object-Centric Decomposition<a class="headerlink" href="#object-centric-decomposition" title="Permanent link"></a></h3>
<p>Decompose complex tasks into object-centric subtasks. The kitchen task's example is as follows:</p>
<p><strong>Stage 1: grasp bowl</strong></p>
<ul>
<li>Start: Robot initial position</li>
<li>Goal: Bowl stably grasped</li>
</ul>
<p><strong>Stage 2: place in microwave</strong></p>
<ul>
<li>Start: Bowl grasped</li>
<li>Goal: Bowl placed inside microwave</li>
</ul>
<p><strong>Stage 3: close microwave door</strong></p>
<ul>
<li>Start: Bowl inside microwave</li>
<li>Goal: Microwave door closed</li>
</ul>
<div style="position: relative; width: 100%; max-width: 800px; margin: 0 auto;">
  <div style="overflow: hidden; width: 100%;">
    <div id="microwave-carousel" style="display: flex !important; gap: 20px; transition: transform 0.3s ease; width: max-content;">
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/microwave_source_demo_subtask/pick_bowl.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Grasp bowl</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/microwave_source_demo_subtask/place_bowl.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Place in microwave</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/microwave_source_demo_subtask/close_door.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Close microwave door</p>
      </div>
    </div>
  </div>
  <button onclick="var el = document.getElementById('microwave-carousel'); var current = parseInt(el.style.transform.replace(/[^\d-]/g, '') || 0); el.style.transform = 'translateX(' + Math.min(0, current + 400) + 'px)'" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px;">❮</button>
  <button onclick="var el = document.getElementById('microwave-carousel'); var current = parseInt(el.style.transform.replace(/[^\d-]/g, '') || 0); el.style.transform = 'translateX(' + Math.max(-400, current - 400) + 'px)'" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px;">❯</button>
</div>

<p><strong>Stage 1: grasp fork</strong></p>
<ul>
<li>Start: Robot initial position</li>
<li>Goal: Fork stably grasped</li>
</ul>
<p><strong>Stage 2: place fork</strong></p>
<ul>
<li>Start: Fork stably grasped</li>
<li>Goal: Fork placed in the blanket</li>
</ul>
<p><strong>Stage 3: grasp plate</strong></p>
<ul>
<li>Start: Fork placed in the blanket</li>
<li>Goal: Plate stably grasped</li>
</ul>
<p><strong>Stage 4: Drop plate</strong></p>
<ul>
<li>Start: Plate stably grasped</li>
<li>Goal: Drop above the left blanket</li>
</ul>
<p><strong>Stage 5: Place plate</strong></p>
<ul>
<li>Start: Drop above the left blanket</li>
<li>Goal: Plate placed in the blanket</li>
</ul>
<div style="position: relative; width: 100%; max-width: 800px; margin: 0 auto;">
  <div style="overflow: hidden; width: 100%;">
    <div id="clean-plate-carousel" style="display: flex !important; gap: 20px; transition: transform 0.3s ease; width: max-content;">
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/clean_plate_subtask/pick_fork.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Grasp fork</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/clean_plate_subtask/place_fork.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Place fork</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/clean_plate_subtask/pick_plate.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Grasp plate</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/clean_plate_subtask/drop_plate.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Drop plate</p>
      </div>
      <div style="width: 380px; flex-shrink: 0;">
        <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
          <source src="../videos/sim/clean_plate_subtask/place_plate.mp4" type="video/mp4">
        </video>
        <p style="text-align: center;">Place plate</p>
      </div>
    </div>
  </div>
  <button onclick="var el = document.getElementById('clean-plate-carousel'); var current = parseInt(el.style.transform.replace(/[^\d-]/g, '') || 0); el.style.transform = 'translateX(' + Math.min(0, current + 400) + 'px)'" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px;">❮</button>
  <button onclick="var el = document.getElementById('clean-plate-carousel'); var current = parseInt(el.style.transform.replace(/[^\d-]/g, '') || 0); el.style.transform = 'translateX(' + Math.max(-1200, current - 400) + 'px)'" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px;">❯</button>
</div>
<h2 id="compare-with-mimicgen">Compare with MimicGen<a class="headerlink" href="#compare-with-mimicgen" title="Permanent link"></a></h2>
<p>WBCMimicGen extends the original MimicGen framework with several key improvements: Whole Body Control (WBC) integration for smoother teleoperation, support for mobile manipulators, enhanced trajectory optimization, and better handling of contact-rich manipulation tasks. These enhancements enable more robust sim-to-real transfer while maintaining the core benefits of object-centric task decomposition and data augmentation.</p>

<h3 id="data-generation-of-mobile-manipulator">Data Generation of Mobile Manipulator<a class="headerlink" href="#data-generation-of-mobile-manipulator" title="Permanent link"></a></h3>

As a key advancement over standard MimicGen, WBCMimicGen can also be used to generate data for mobile manipulator. The following video shows the data generation of a mobile manipulator. In this task, we use ARX7 to pick up the toothpaste and put it in the cup and then put the cup near the wall:

<div style="display: flex; gap: 20px; width: 100%;">
  <div style="flex: 1;">
    <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
      <source src="../videos/sim/arx7/arx.mp4" type="video/mp4">
    </video>
    <p style="text-align: center;">Camera on the robot's head.</p>
  </div>
  <div style="flex: 1;">
    <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
      <source src="../videos/sim/arx7/arx_2.mp4" type="video/mp4">
    </video>
    <p style="text-align: center;">Camera in the environment.</p>
  </div>
</div>

<h2 id="large-scale-data-generation">Large-scale Data Generation<a class="headerlink" href="#large-scale-data-generation" title="Permanent link"></a></h2>

<p>
With WBCMimicGen, we can generate large-scale data, enabling better policy training:

</p>
<div style="display: flex; gap: 20px; width: 100%;">
  <div style="flex: 1;">
    <video controls autoplay loop muted style="width: 100%; height: auto; object-fit: cover;">
      <source src="../videos/sim/large-scale-generate.mp4" type="video/mp4">
    </video>
  </div>
</div>
<h2 id="dataset-management">Dataset Management<a class="headerlink" href="#dataset-management" title="Permanent link"></a></h2>
<h3 id="data-format">Data Format<a class="headerlink" href="#data-format" title="Permanent link"></a></h3>
<p>Using Zarr format for storage, supporting efficient parallel read/write:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">Dataset</span> <span class="n">structure</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">dataset</span><span class="o">/</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="err">├──</span> <span class="n">observations</span><span class="o">/</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="err">│</span>   <span class="err">├──</span> <span class="n">rgb</span><span class="o">/</span>           <span class="c1"># RGB images</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="err">│</span>   <span class="err">├──</span> <span class="n">depth</span><span class="o">/</span>         <span class="c1"># Depth maps</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="err">│</span>   <span class="err">├──</span> <span class="n">point_cloud</span><span class="o">/</span>   <span class="c1"># Point cloud data</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="err">│</span>   <span class="err">└──</span> <span class="n">robot_state</span><span class="o">/</span>   <span class="c1"># Robot states</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="err">├──</span> <span class="n">actions</span><span class="o">/</span>           <span class="c1"># Action sequences</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="err">├──</span> <span class="n">rewards</span><span class="o">/</span>           <span class="c1"># Reward signals (if available)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="err">└──</span> <span class="n">metadata</span><span class="o">/</span>          <span class="c1"># Metadata</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="err">├──</span> <span class="n">success</span><span class="o">/</span>       <span class="c1"># Success flags</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="err">├──</span> <span class="n">subtask_labels</span><span class="o">/</span><span class="c1"># Subtask annotations</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="err">└──</span> <span class="n">timestamps</span><span class="o">/</span>    <span class="c1"># Timestamps</span>
</code></pre></div>
<h2 id="code-reference">Code Reference<a class="headerlink" href="#code-reference" title="Permanent link"></a></h2>
<p>Data generation related code:</p>
<p><strong>Teleoperation System:</strong></p>
<ul>
<li>SpaceMouse control: <code>ManiUniCon/maniunicon/policies/spacemouse.py</code></li>
<li>Quest VR control: <code>ManiUniCon/maniunicon/policies/quest.py</code></li>
</ul>
<p><strong>Data Generation Scripts:</strong></p>
<ul>
<li>Generation configuration: <code>manip-as-in-sim-suite/wbcmimic/config/mimicgen/generate_data.yaml</code></li>
<li>Parallel generation: <code>manip-as-in-sim-suite/wbcmimic/scripts/mimicgen/generate_dataset_parallel_all.py</code></li>
<li>Data replay: <code>manip-as-in-sim-suite/wbcmimic/scripts/mimicgen/replay_demos.py</code></li>
</ul>
<p><strong>Data Processing Tools:</strong></p>
<ul>
<li>Zarr data management: <code>manip-as-in-sim-suite/wbcmimic/source/isaaclab_mimic/isaaclab_mimic/utils/datasets/</code></li>
<li>Data visualization: <code>manip-as-in-sim-suite/wbcmimic/scripts/data_tools/draw_data_distribution.py</code></li>
</ul>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link"></a></h2>
<p>After completing large-scale data generation, we have obtained a rich training dataset. The next stage will use this data for imitation learning, training robot control policies, and ultimately deploying them in the real world for validation.</p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
<script src="../js/nav-hierarchy.js"></script>
</body>
</html>