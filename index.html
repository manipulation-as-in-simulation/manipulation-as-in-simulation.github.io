<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manipulation as in Simulation: Enabling Accurate Geometry Perception in Robots</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Optimized Three.js for point cloud visualization -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/PLYLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    
    <!-- Chart.js for lightweight, fast interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/depth-charts.js" defer></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <a href="https://seed.bytedance.com/en/" target="_blank" class="logo-link">
                <img src="seed/seed_logo.png" alt="ByteDance Seed" class="bytedance-seed-logo">
            </a>
        </div>
        <div class="container">
            <div class="header-content">
                <h1 class="title">Manipulation as in Simulation:<br>Enabling Accurate Geometry Perception in Robots</h1>
            
            <div class="authors">
                <div class="author-row">
                    <span class="author"><a href="https://minghuanliu.com" target="_blank">Minghuan Liu</a><sup>1,*,â€ </sup></span>
                    <span class="author"><a href="https://zbzhu99.github.io/" target="_blank">Zhengbang Zhu</a><sup>1,2,*</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=Mo8I5WMAAAAJ/" target="_blank">Xiaoshen Han</a><sup>1,2,*</sup></span>
                    <span class="author">Peng Hu<sup>1,*</sup></span>
                    <span class="author"><a href="https://haotongl.github.io/" target="_blank">Haotong Lin</a><sup>1,3</sup></span>
                    <span class="author">Xinyao Li<sup>2</sup></span>
                </div>
                <div class="author-row">
                    <span class="author"><a href="https://timerchen.github.io/" target="_blank">Jingxiao Chen</a><sup>1,2</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=GPmUxtIAAAAJ" target="_blank">Jiafeng Xu</a><sup>1</sup></span>
                    <span class="author"><a href="https://yangyichu.github.io/" target="_blank">Yichu Yang</a><sup>1</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=0ar3JNYAAAAJ" target="_blank">Yunfeng Lin</a><sup>2</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=laOWyTQAAAAJ" target="_blank">Xinghang Li</a><sup>4</sup></span>
                </div>
                <div class="author-row">
                    <span class="author"><a href="https://scholar.google.com/citations?user=-84M1m0AAAAJ" target="_blank">Yong Yu</a><sup>2</sup></span>
                    <span class="author"><a href="http://wnzhang.net/" target="_blank">Weinan Zhang</a><sup>2</sup></span>
                    <span class="author"><a href="https://www.taokong.org/" target="_blank">Tao Kong</a><sup>1</sup></span>
                    <span class="author"><a href="https://bingykang.github.io/" target="_blank">Bingyi Kang</a><sup>1,â€ </sup></span>
                </div>
            </div>
            
            <div class="affiliations">
                <div class="affiliation"><sup>1</sup>ByteDance Seed</div>
                <div class="affiliation"><sup>2</sup>Shanghai Jiao Tong University</div>
                <div class="affiliation"><sup>3</sup>Zhejiang University</div>
                <div class="affiliation"><sup>4</sup>Tsinghua University</div>
            </div>
            
            <div class="notes">
                <p><sup>*</sup>Equal Contribution &nbsp;&nbsp; <sup>â€ </sup>Corresponding Authors</p>
                <p>Minghuan did this work when he was at ByteDance Seed.</p>
            </div>
            
            <div class="contributions-compact">
                <a href="#dataset" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">ðŸ“Š</div>
                        <div class="contribution-text">
                            <h4>ByteCamDepth Dataset</h4>
                            <p>170K+ RGB-depth pairs from 7 cameras</p>
                        </div>
                    </div>
                </a>
                <a href="#cdm-results" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">ðŸ”§</div>
                        <div class="contribution-text">
                            <h4>Camera Depth Models</h4>
                            <p>Plug-in solution for accurate depth perception</p>
                        </div>
                    </div>
                </a>
                <a href="#setup" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">ðŸš€</div>
                        <div class="contribution-text">
                            <h4>Sim-to-Real Transfer</h4>
                            <p>CDMs make depth-only policies seamless transfer</p>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="links">
                <a href="#" class="btn"><i class="fas fa-file-pdf"></i> Paper</a>
                <div class="dropdown">
                    <span class="btn dropdown-btn"><i class="fab fa-github"></i> Code</span>
                    <div class="dropdown-content">
                        <a href="https://github.com/ByteDance-Seed/manip-as-in-sim-suite" target="_blank">
                            <i class="fab fa-github" style="margin-right: 8px;"></i>
                            <strong>Manipulation Suite</strong>
                            <br>
                            <small style="color: #666;">Sim2real & CDM inference code</small>
                        </a>
                        <a href="https://github.com/Universal-Control/ManiUniCon" target="_blank">
                            <i class="fas fa-robot" style="margin-right: 8px;"></i>
                            <strong>ManiUniCon</strong>
                            <br>
                            <small style="color: #666;">Unified & modular robot control</small>
                        </a>
                    </div>
                </div>
                <a href="#dataset" class="btn"><i class="fas fa-database"></i> Dataset</a>
                <a href="#models" class="btn"><i class="fas fa-cube"></i> Models</a>
                <a href="https://manipulation-as-in-simulation.github.io/docs" target="_blank" class="btn"><i class="fas fa-book"></i> S2R Docs</a>
            </div>
            </div>
        </div>
    </header>

    <section id="models" class="models">
        <div class="container">
            <h2>Available Camera Depth Models</h2>
            <p style="margin-bottom: 15px;">We release camera depth models for various widely-used depth cameras.</p>
            <p>Try to plug them into your existing robot pipeline to improve the depth perception accuracy!</p>
            
            <div class="model-grid" style="display: flex; justify-content: center; align-items: stretch; gap: 5px; flex-wrap: wrap;">
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-405</h3>
                    <p>For RealSense D405 camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-435</h3>
                    <p>For RealSense D435 camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-L515</h3>
                    <p>For RealSense L515 camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-Kinect</h3>
                    <p>For Azure Kinect camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-Zed2i N</h3>
                    <p>For Zed2i camera, Neural mode</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card" style="flex: 0 0 180px; padding: 20px;">
                    <h3>CDM-Zed2i Q</h3>
                    <p>For Zed2i camera, Quality mode</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
            </div>
        </div>
    </section>

    <section class="video">
        <div class="container">
            <h2>Video Overview</h2>
            <div class="video-container">
                <iframe width="80%" height="300" src="https://www.youtube.com/embed/cPTuK3nKvs8" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </section>

    <section class="abstract">
        <div class="container">
            <h2>Abstract</h2>
            <img src="figs/teaser.png" alt="Teaser Figure" class="teaser-image">
            <p>
                Modern robotic manipulation primarily relies on visual observations in a 2D color space for skill learning, but suffers from poor generalization. In contrast, humans, living in a 3D world, depend more on physical propertiesâ€”such as distance, size, and shapeâ€”than on texture when interacting with objects. Since such 3D geometric information can be acquired from widely available depth cameras, it appears feasible to endow robots with similar perceptual capabilities. Our pilot study found that using depth cameras for manipulation is challenging, primarily due to their limited accuracy and susceptibility to various types of noise. In this work, we propose <strong>Camera Depth Models (CDMs)</strong> as a simple plugin on daily-use depth cameras, which take RGB images and raw depth signals as input and output denoised, accurate metric depth. To achieve this, we develop a neural data engine that generates high-quality paired data from simulation by modeling a depth camera's noise pattern. Our results show that CDMs achieve nearly simulation-level accuracy in depth prediction, effectively bridging the sim-to-real gap for manipulation tasks. Notably, our experiments demonstrate, <strong>for the first time</strong>, that a policy trained on raw simulated depth, <strong>without the need for adding noise, or real-world fine-tuning</strong>, generalizes seamlessly to real-world robots on <strong> two challenging long-horizon tasks involving articulated and slender objects</strong>, with little to no performance degradation. Further analysis reveals that sim-to-real success rates are strongly correlated with the quality of depth perception. We hope our findings will inspire future research in utilizing simulation data and 3D information in general robot policies.
            </p>
        </div>
    </section>

    <section id="dataset" class="dataset">
        <div class="container">
            <h2>ByteCamDepth Dataset</h2>
            <p>We introduce ByteCamDepth, a real-world multi-camera depth dataset comprising over <strong>170,000 RGB-depth pairs</strong> from ten distinct configurations captured by seven depth cameras.</p>
            <div class="dataset-stats">
                <div class="stat-item">
                    <h3>170K+</h3>
                    <p>RGB-Depth Pairs</p>
                </div>
                <div class="stat-item">
                    <h3>7</h3>
                    <p>Depth Cameras</p>
                </div>
                <div class="stat-item">
                    <h3>10</h3>
                    <p>Configurations</p>
                </div>
            </div>
            
            <!-- Dataset Image Selector -->
            <div class="dataset-selector-container">
                <div class="selector-group">
                    <span class="selector-label">Camera:</span>
                    <div class="selector-buttons" id="camera-dataset-selector">
                        <button class="selector-btn active" data-camera="d405">D405</button>
                        <button class="selector-btn" data-camera="d415">D415</button>
                        <button class="selector-btn" data-camera="d435">D435</button>
                        <button class="selector-btn" data-camera="d455">D455</button>
                        <button class="selector-btn" data-camera="l515">L515</button>
                        <button class="selector-btn" data-camera="kinect">Kinect</button>
                        <button class="selector-btn" data-camera="zed2i_neural">ZED2i-N.</button>
                        <button class="selector-btn" data-camera="zed2i_ultra">ZED2i-U.</button>
                        <button class="selector-btn" data-camera="zed2i_quality">ZED2i-Q.</button>
                        <button class="selector-btn" data-camera="zed2i_performance">ZED2i-P.</button>
                    </div>
                </div>
                <div class="selector-group">
                    <span class="selector-label">Scene:</span>
                    <div class="selector-buttons" id="scene-dataset-selector">
                        <button class="selector-btn active" data-scene="living">Living</button>
                        <button class="selector-btn" data-scene="kitchen">Kitchen</button>
                        <button class="selector-btn" data-scene="bedroom">Bedroom</button>
                        <button class="selector-btn" data-scene="bathroom">Bathroom</button>
                        <button class="selector-btn" data-scene="office">Office</button>
                        <button class="selector-btn" data-scene="market">Market</button>
                        <button class="selector-btn" data-scene="BreakRoom">Break Room</button>
                    </div>
                </div>
                <div class="selector-group">
                    <span class="selector-label">Example Pairs:</span>
                    <div class="selector-buttons" id="pair-dataset-selector">
                        <button class="selector-btn active" data-pair="0">1</button>
                        <button class="selector-btn" data-pair="1">2</button>
                        <button class="selector-btn" data-pair="2">3</button>
                        <button class="selector-btn" data-pair="3">4</button>
                        <button class="selector-btn" data-pair="4">5</button>
                        <button class="selector-btn" data-pair="5">6</button>
                    </div>
                </div>
            </div>
            
            <div class="dataset-images" id="dataset-images-container">
                <div class="rgb-depth-pair">
                    <div class="rgb-depth-item">
                        <img id="dataset-rgb-image" src="figs/rgb_depth/camera_d435/living_rgb_0.png" alt="RGB Image">
                        <p>RGB Image</p>
                    </div>
                    <div class="rgb-depth-item">
                        <img id="dataset-depth-image" src="figs/rgb_depth/camera_d435/living_depth_0.png" alt="Depth Image">
                        <p>Depth Image</p>
                    </div>
                </div>
                <p style="text-align: center; color: #666; font-size: 0.95rem; margin: 20px 0 15px 0;">Each Scene is Visualized in a Different Fixed Min-Max Range</p>
                
                <!-- Spectral Colormap Bar -->
                <div class="colormap-container">
                    <div class="colormap-bar">
                        <canvas id="spectral-colormap" width="800" height="40"></canvas>
                    </div>
                    <div class="colormap-labels">
                        <span class="colormap-label">Near</span>
                        <span class="colormap-label">Far</span>
                    </div>
                </div>
            </div>
            
            <!-- Dataset Actions - Download and Point Cloud Comparison -->
            <div style="display: flex; justify-content: center; align-items: center; gap: 30px; flex-wrap: wrap; margin-top: 30px;">
                <a href="#" class="btn-dataset-download">
                    <i class="fas fa-download"></i>
                    <span class="download-text">
                        <strong>Download ByteCamDepth Dataset</strong>
                    </span>
                    <i class="fas fa-arrow-right arrow-icon"></i>
                </a>
                
                <a href="#point-cloud-comparison" class="btn" style="display: inline-block; padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-size: 1.1rem; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                    <i class="fas fa-cube" style="margin-right: 10px;"></i>
                    Check Point Clouds
                    <i class="fas fa-arrow-right" style="margin-left: 10px;"></i>
                </a>
            </div>
        </div>
    </section>

    <section class="setup" id="setup">
        <div class="container">
            <h2>UR5 Manipulation Experiment Setup</h2>
            
            <!-- Depth-Only Imitation Learning Section -->
            <div class="setup-subsection">
                <h3 class="setup-subtitle">Imitation Learning with Only Depth</h3>
                <p class="setup-description">A pilot study on real-world imitation learning with only geometric information for manipulation.</p>
                
                <div class="setup-row-2col">
                    <div class="setup-item-large">
                        <img src="figs/toothpaste_setup.jpg" alt="Place Toothpaste Task Setup">
                        <h4>Toothpaste-and-Cup Task</h4>
                    </div>
                    <div class="setup-item-large">
                        <img src="figs/stackbowl_setup.jpg" alt="Stack Bowls Task Setup">
                        <h4>Stack-Bowls Task</h4>
                    </div>
                </div>
            </div>
            
            <!-- Sim-to-Real Transfer Section -->
            <div class="setup-subsection">
                <h3 class="setup-subtitle">Sim-to-Real Transfer</h3>
                <p class="setup-description">Simulation training and real-world deployment with D435 and L515 cameras (zero-shot transfer).</p>
                
                <div class="setup-row">
                    <div class="setup-item-exp">
                        <img src="figs/ur5-setup-sim.png" alt="Overall setup (sim)">
                        <h4>Overall Setup (Simulation)</h4>
                        <p>Simulation environment with camera pose randomization for demonstration generation</p>
                    </div>
                    <div class="setup-item-exp">
                        <img src="figs/sim-range-microwave.png" alt="Kitchen task randomization (sim)">
                        <h4>Kitchen Task Randomization (Sim)</h4>
                        <p>Randomization for bowl and microwave <strong>(articulated objects with transparent glass)</strong> positions</p>
                    </div>
                    <div class="setup-item-exp">
                        <img src="figs/sim-range-plate.png" alt="Canteen task randomization (sim)">
                        <h4>Canteen Task Randomization (Sim)</h4>
                        <p>Randomization for fork <strong></strong>(reflective and slender)</strong>, plate <strong>(thin)</strong> and box positions</p>
                    </div>
                </div>
                
                <div class="setup-row">
                    <div class="setup-item-exp">
                        <img src="figs/ur5-setup.png" alt="Overall setup (real)">
                        <h4>Overall Setup (Real)</h4>
                        <p>Real-world UR5 robot setup with third-view depth camera for manipulation tasks</p>
                    </div>
                    <div class="setup-item-exp">
                        <img src="figs/kitchen-distribution.png" alt="Kitchen task distribution (real)">
                        <h4>Kitchen Task Distribution (Real)</h4>
                        <p>Test distribution following simulation randomization boundaries for real-world experiments</p>
                    </div>
                    <div class="setup-item-exp">
                        <img src="figs/canteen-distribution.png" alt="Canteen task distribution (real)">
                        <h4>Canteen Task Distribution (Real)</h4>
                        <p>Test distribution following simulation randomization boundaries for real-world experiments</p>
                    </div>
                </div>
                
                
                <!-- Pipeline Subsection -->
                <div class="subsection" style="margin-top: 40px;">
                    <h3>Pipeline</h3>
                    <p style="text-align: center; margin-bottom: 30px; color: #666;">Leverages CDMs to bridge the geometric gap between simulation and real-world.</p>
                    <div style="display: flex; align-items: center; justify-content: center; flex-wrap: wrap; gap: 15px; margin: 20px auto;">
                        <!-- Stage 1 -->
                        <div style="text-align: center;">
                            <a href="https://manipulation-as-in-simulation.github.io/docs/stage1-task-scene-construction/index.html" target="_blank" style="text-decoration: none;">
                                <img src="figs/cdm-pipeline-stage-1.png" alt="Stage 1: Task&Scene Construction" style="max-width: 240px; width: 100%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            </a>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">Stage 1: Task&Scene Construction</p>
                        </div>
                        
                        <!-- Arrow 1 -->
                        <i class="fas fa-arrow-right" style="font-size: 2rem; color: #667eea;"></i>
                        
                        <!-- Stage 2 -->
                        <div style="text-align: center;">
                            <a href="https://manipulation-as-in-simulation.github.io/docs/stage2-calibration/index" target="_blank" style="text-decoration: none;">
                                <img src="figs/cdm-pipeline-stage-2.png" alt="Stage 2: Camera Calibration" style="max-width: 240px; width: 100%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            </a>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">Stage 2: Camera Calibration</p>
                        </div>
                        
                        <!-- Arrow 2 -->
                        <i class="fas fa-arrow-right" style="font-size: 2rem; color: #667eea;"></i>
                        
                        <!-- Stage 3 -->
                        <div style="text-align: center;">
                            <a href="https://manipulation-as-in-simulation.github.io/docs/stage3-data-generation/index.html" target="_blank" style="text-decoration: none;">
                                <img src="figs/cdm-pipeline-stage-3.png" alt="Stage 3: Data Generation" style="max-width: 240px; width: 100%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            </a>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">Stage 3: Data Generation</p>
                        </div>
                        
                        <!-- Arrow 3 -->
                        <i class="fas fa-arrow-right" style="font-size: 2rem; color: #667eea;"></i>
                        
                        <!-- Stage 4 -->
                        <div style="text-align: center;">
                            <a href="https://manipulation-as-in-simulation.github.io/docs/stage4-imitation-learning-deployment/index.html" target="_blank" style="text-decoration: none;">
                                <img src="figs/cdm-pipeline-stage-4.png" alt="Stage 4: Real-World Deployment" style="max-width: 240px; width: 100%; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            </a>
                            <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">Stage 4: Learning&Deployment</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <a href="https://manipulation-as-in-simulation.github.io/docs" target="_blank" class="btn" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                            <i class="fas fa-book" style="margin-right: 8px;"></i>
                            View Complete Tutorial
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="quantitative-results" class="quantitative-results">
        <div class="container">
            <h2>Manipulation Results</h2>
            
            <p style="margin-bottom: 20px; color: #666;">** Note that our goal is <strong>NOT to identify if depth is a better visual modality than color</strong> , <strong>BUT to validate whether accurate geometry information contained in a more precise depth image can benefit manipulation</strong>. Therefore, the policies designed in our experiments are depth-only to exclude the effect of color information.</p>
            
            <div class="table-section">
                <h3>A Pilot Study on Imitation Learning with Only Depth</h3>
                <div class="imitation-results-grid">
                    <div class="table-item">
                        <div class="imitation-table-container">
                            <table class="imitation-table">
                                <thead>
                                    <tr>
                                        <th rowspan="3">Depth Model</th>
                                        <th colspan="2">Toothpaste-and-Cup</th>
                                        <th colspan="2">Stack-Bowls</th>
                                    </tr>
                                    <tr>
                                        <th>Pick Toothpaste</th>
                                        <th>Put Toothpaste into Cup</th>
                                        <th>Pick Bowl</th>
                                        <th>Stack Bowls</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>None</td>
                                        <td>0/15</td>
                                        <td>0/15</td>
                                        <td>6/15</td>
                                        <td>3/15</td>
                                    </tr>
                                    <tr class="best-result">
                                        <td><strong>CDM-D435</strong></td>
                                        <td><strong>10/15</strong></td>
                                        <td><strong>6/15</strong></td>
                                        <td><strong>11/15</strong></td>
                                        <td><strong>9/15</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <h4>Results w/w.o CDM</h4>
                        <p>50 demonstrations for each task, collected by teleoperation</p>
                    </div>
                    <div class="figure-item">
                        <h4>Generalization Over Different Object Sizes</h4>
                        <p>Policies trained without CDM cannot generalize to unseen sizes (0 SR), while CDM-enhanced policies show better generalization.</p>
                        <img src="figs/success-rate-hist.png" alt="Success Rate Histogram">
                    </div>
                </div>
                
                <!-- Video demonstrations for Depth-Only IL -->
                <div class="demo-videos" style="margin-top: 30px;">
                    <h4 style="text-align: center; margin-bottom: 20px;">Demo Videos</h4>
                    <div class="video-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; max-width: 900px; margin: 0 auto;">
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/iphone-demos/toothpaste_demo_iphone.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Toothpaste-and-Cup Task</p>
                        </div>
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/iphone-demos/stackbowl_demo_iphone.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Stack-Bowls Task</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-section">
                <h3>Zero-Shot Sim-to-Real Transfer Results</h3>
                <!-- Zero-Shot Transfer Results Subsection -->
                <div class="subsection">
                    <p style="margin-bottom: 1px; color: #666;">Zero-shot sim-to-real results using CDMs as plugin in real-world robot pipeline.</p>
                    <p style="margin-bottom: 20px; color: #666;">* The policy is robust to external interruptions during the test.</p>
                    
                    <!-- Real-world demo videos -->
                    <div class="demo-videos" style="margin-top: 30px;">
                        <h4 style="text-align: center; margin-bottom: 20px;">Demo Videos</h4>
                        <div class="video-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; max-width: 900px; margin: 0 auto;">
                            <div class="video-item">
                                <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <source src="vids/iphone-demos/kitchen_demo_iphone.mp4" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <p style="text-align: center; margin-top: 10px; color: #666;">Kitchen Task - Real Robot</p>
                            </div>
                            <div class="video-item">
                                <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                    <source src="vids/iphone-demos/canteen_demo_iphone.mp4" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <p style="text-align: center; margin-top: 10px; color: #666;">Canteen Task - Real Robot</p>
                            </div>
                        </div>
                    </div>

                    <div class="video-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 900px; margin: 0 auto;">
                        <div class="video-pair">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="video-item">
                                    <div id="kitchen-comparison" class="bal-container-small">
                                        <div class="bal-after">
                                            <video muted autoplay playsinline loop style="width: 100%; display: block;">
                                                <source src="vids/kitchen-real/output_ep000_camera_0_rgb.mp4" type="video/mp4">
                                            </video>
                                        </div>
                                        <div class="bal-before" style="width:50%;">
                                            <div class="bal-before-inset">
                                                <video muted autoplay playsinline loop style="width: 100%; display: block;">
                                                    <source src="vids/kitchen-real/output_ep000_camera_0_depth.mp4" type="video/mp4">
                                                </video>
                                            </div>
                                        </div>
                                        <div class="bal-handle" style="left:50%;">
                                            <span class="handle-left-arrow"></span>
                                            <span class="handle-right-arrow"></span>
                                        </div>
                                    </div>
                                    <p style="text-align: center; margin-top: 18px; color: #666; font-size: 0.9rem;">Camera RGB/Depth</p>
                                </div>
                                <div class="video-item">
                                    <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <source src="vids/kitchen-real/output_ep000_camera_0_model_depth.mp4" type="video/mp4">
                                    </video>
                                    <p style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9rem;">CDM Depth</p>
                                </div>
                            </div>
                        </div>
                        <div class="video-pair">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="video-item">
                                    <div id="canteen-comparison" class="bal-container-small">
                                        <div class="bal-after">
                                            <video muted autoplay playsinline loop style="width: 100%; display: block;">
                                                <source src="vids/canteen-real/h264_output_ep000_camera_0_rgb.mp4" type="video/mp4">
                                            </video>
                                        </div>
                                        <div class="bal-before" style="width:50%;">
                                            <div class="bal-before-inset" style="width: 100%;">
                                                <video muted autoplay playsinline loop style="width: 100%; display: block;">
                                                    <source src="vids/canteen-real/h264_output_ep000_camera_0_depth.mp4" type="video/mp4">
                                                </video>
                                            </div>
                                        </div>
                                        <div class="bal-handle" style="left:50%;">
                                            <span class="handle-left-arrow"></span>
                                            <span class="handle-right-arrow"></span>
                                        </div>
                                    </div>
                                    <p style="text-align: center; margin-top: 18px; color: #666; font-size: 0.9rem;">Camera RGB/Depth</p>
                                </div>
                                <div class="video-item">
                                    <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <source src="vids/canteen-real/h264_output_ep000_camera_0_model_depth.mp4" type="video/mp4">
                                    </video>
                                    <p style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9rem;">CDM Depth</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th rowspan="3">Camera</th>
                            <th rowspan="3">Depth Model</th>
                            <th colspan="4">Kitchen Task</th>
                            <th colspan="6">Canteen Task</th>
                        </tr>
                        <tr>
                            <th>Pick Bowl</th>
                            <th>Put Bowl into Microwave</th>
                            <th>Close Microwave</th>
                            <th>Total</th>
                            <th>Pick Fork</th>
                            <th>Place Fork</th>
                            <th>Pick Plate</th>
                            <th>Dump Plate</th>
                            <th>Place Plate</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Sim (D435-View)</td><td>None</td><td>43/50</td><td>33/50</td><td>32/50</td><td>30/50</td><td>40/50</td><td>28/50</td><td>47/50</td><td>45/50</td><td>33/50</td><td>21/50</td></tr>
                        <tr><td rowspan="5">D435</td><td>None</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                        <tr><td>PromptDA</td><td>11/30</td><td>5/30</td><td>0/30</td><td>0/30</td><td>17/30</td><td>16/30</td><td>7/30</td><td>2/30</td><td>6/30</td><td>1/30</td></tr>
                        <tr><td>PriorDA</td><td>16/30</td><td>8/30</td><td>7/30</td><td>7/30</td><td><strong>30/30</strong></td><td><strong>30/30</strong></td><td>1/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                        <tr class="best-result"><td><strong>CDM-D435</strong></td><td><strong>29/30</strong></td><td><strong>26/30</strong></td><td><strong>26/30</strong></td><td><strong>26/30</strong></td><td><strong>30/30</strong></td><td><strong>30/30</strong></td><td><strong>15/30</strong></td><td><strong>14/30</strong></td><td><strong>14/30</strong></td><td><strong>14/30</strong></td></tr>
                        <tr class="best-result"><td>CDM-L515</td><td><strong>29/30</strong></td><td>22/30</td><td>16/30</td><td>14/30</td><td><strong>30/30</strong></td><td>29/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                    </tbody>
                    <tbody>
                        <tr><td>Sim (L515-View)</td><td>None</td><td>43/50</td><td>34/50</td><td>37/50</td><td>32/50</td><td>40/50</td><td>26/50</td><td>46/50</td><td>43/50</td><td>31/50</td><td>20/50</td></tr>
                        <tr><td rowspan="5">L515</td><td>None</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                        <tr><td>PromptDA</td><td>3/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>3/30</td><td>0/30</td><td>3/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                        <tr><td>PriorDA</td><td>17/30</td><td>3/30</td><td>2/30</td><td>2/30</td><td>10/30</td><td>8/30</td><td>3/30</td><td>3/30</td><td>3/30</td><td>3/30</td></tr>
                        <tr class="best-result"><td>CDM-D435</td><td>22/30</td><td>11/30</td><td>9/30</td><td>9/30</td><td>13/30</td><td>11/30</td><td>11/30</td><td>10/30</td><td>9/30</td><td>9/30</td></tr>
                        <tr class="best-result"><td><strong>CDM-L515</strong></td><td><strong>25/30</strong></td><td><strong>18/30</strong></td><td><strong>18/30</strong></td><td><strong>18/30</strong></td><td><strong>24/30</strong></td><td><strong>24/30</strong></td><td><strong>22/30</strong></td><td><strong>22/30</strong></td><td><strong>22/30</strong></td><td><strong>22/30</strong></td></tr>
                    </tbody>
                    </table>
                </div>

                <!-- Sim-to-Real Transfer Videos -->
                <div class="demo-videos" style="margin-top: 10px;">
                    <h4 style="text-align: center; margin-bottom: 20px;">Sim-Real Comparisons</h4>
                    <p style="margin-bottom: 20px; color: #666;">* Real-world videos are slightly speed up for alignment (~1.4x)</p>
                    <div class="video-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 1200px; margin: 0 auto;">
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/sim-real/Sim-Real-Kitchen-435.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Kitchen Task - D435 Camera</p>
                        </div>
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/sim-real/Sim-Real-Kitchen-515.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Kitchen Task - L515 Camera</p>
                        </div>
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/sim-real/Sim-Real-Canteen-435.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Canteen Task - D435 Camera</p>
                        </div>
                        <div class="video-item">
                            <video class="demo-video" controls muted loop playsinline style="width: 100%; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <source src="vids/sim-real/Sim-Real-Canteen-515.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <p style="text-align: center; margin-top: 10px; color: #666;">Canteen Task - L515 Camera</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <section class="results" id="cdm-results">
        <div class="container">
            <div class="section-header-with-button">
                <h2 style="margin-block-end: 0;">How do CDMs work?</h2>
                <a href="#models" class="btn-inline-download">
                    <i class="fas fa-download"></i>
                    <span>Download CDMs</span>
                </a>
            </div>
            <div class="result-section">
                <h3>Depth Quality Comparison</h3>
                <div class="comparison-full">
                    <h4>Kitchen Scene</h4>
                    <div class="image-row-6">
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-D435 Output</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-L515 Output</p>
                        </div>
                    </div>
                    
                    <h4>Canteen Scene</h4>
                    <div class="image-row-6">
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-D435 Output</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-L515 Output</p>
                        </div>
                    </div>
                    
                    <div class="image-row-6">
                        <div style="grid-column: 1 / 4;">
                            <h4>Stack Bowls Scene</h4>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <div class="image-item">
                                    <img src="figs/compare_depths/stackbowl_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                                    <p>RGB Image (D435)</p>
                                </div>
                                <div class="image-item">
                                    <img src="figs/compare_depths/stackbowl_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                                    <p>Raw Depth (D435)</p>
                                </div>
                                <div class="image-item">
                                    <img src="figs/compare_depths/stackbowl_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                                    <p>CDM-D435 Output</p>
                                </div>
                            </div>
                        </div>
                        <div style="grid-column: 4 / 7;">
                            <h4>Place Toothpaste Scene</h4>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                                <div class="image-item">
                                    <img src="figs/compare_depths/placetoothpaste_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                                    <p>RGB Image (D435)</p>
                                </div>
                                <div class="image-item">
                                    <img src="figs/compare_depths/placetoothpaste_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                                    <p>Raw Depth (D435)</p>
                                </div>
                                <div class="image-item">
                                    <img src="figs/compare_depths/placetoothpaste_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                                    <p>CDM-D435 Output</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-section">
                <h3>Point Cloud Quality Comparison</h3>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">Interactive 3D visualization - Use mouse to rotate, scroll to zoom</p>
                
                <!-- Scene and Camera Selection Buttons -->
                <div class="pcd-selector-container">
                    <div class="selector-group">
                        <span class="selector-label">Scene:</span>
                        <div class="selector-buttons" id="scene-selector">
                            <button class="selector-btn active" data-scene="kitchen">Kitchen</button>
                            <button class="selector-btn" data-scene="canteen">Canteen</button>
                            <button class="selector-btn" data-scene="stackbowl">Stack Bowls</button>
                            <button class="selector-btn" data-scene="toothpaste">Place Toothpaste</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Camera:</span>
                        <div class="selector-buttons" id="camera-selector">
                            <button class="selector-btn active" data-camera="435">D435</button>
                            <button class="selector-btn" data-camera="515">L515</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Model A:</span>
                        <div class="selector-buttons" id="model-a-selector">
                            <button class="selector-btn active" data-model="435">CDM-D435</button>
                            <button class="selector-btn" data-model="515">CDM-L515</button>
                            <button class="selector-btn" data-model="priorda">PriorDA</button>
                            <button class="selector-btn" data-model="promptda">PromptDA</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Model B:</span>
                        <div class="selector-buttons" id="model-b-selector">
                            <button class="selector-btn" data-model="435">CDM-D435</button>
                            <button class="selector-btn active" data-model="515">CDM-L515</button>
                            <button class="selector-btn" data-model="priorda">PriorDA</button>
                            <button class="selector-btn" data-model="promptda">PromptDA</button>
                        </div>
                    </div>
                </div>
                
                <!-- Debug Info Panel (only visible in debug mode) -->
                <div id="debug-panel" class="debug-panel" style="display: none;">
                    <h4>Camera View Parameters (Debug Mode)</h4>
                    <div class="debug-content">
                        <div class="debug-viewer-info">
                            <h5>Left Viewer (Raw Depth)</h5>
                            <div class="debug-params">
                                <div>Position: <span id="debug-left-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="debug-left-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-viewer-info">
                            <h5>Right Viewer (CDM Output)</h5>
                            <div class="debug-params">
                                <div>Position: <span id="debug-right-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="debug-right-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-scene-info">
                            <small>Scene: <span id="debug-scene">-</span> | Camera: <span id="debug-camera">-</span></small>
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Point Cloud Display Area -->
                <div id="pcd-dynamic-display">
                    <!-- Kitchen D435 (default view) -->
                    <div class="pcd-scene-camera-group" data-scene="kitchen" data-camera="435">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Kitchen Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-kitchen-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-raw" data-ply-path="pcds/microwave_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="kitchen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-model-a" data-ply-path="pcds/microwave_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="kitchen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-model-b" data-ply-path="pcds/microwave_435_model_515_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kitchen L515 -->
                    <div class="pcd-scene-camera-group" data-scene="kitchen" data-camera="515" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Kitchen Scene - L515 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-kitchen-515">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-raw" data-ply-path="pcds/microwave_515_raw_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="kitchen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-model-a" data-ply-path="pcds/microwave_515_model_435_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="kitchen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-model-b" data-ply-path="pcds/microwave_515_model_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canteen D435 -->
                    <div class="pcd-scene-camera-group" data-scene="canteen" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Canteen Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-canteen-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-raw" data-ply-path="pcds/canteen_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="canteen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-model-a" data-ply-path="pcds/canteen_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="canteen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-model-b" data-ply-path="pcds/canteen_435_model_515_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canteen L515 -->
                    <div class="pcd-scene-camera-group" data-scene="canteen" data-camera="515" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Canteen Scene - L515 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-canteen-515">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-raw" data-ply-path="pcds/canteen_515_raw_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="canteen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-model-a" data-ply-path="pcds/canteen_515_model_435_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="canteen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-model-b" data-ply-path="pcds/canteen_515_model_515_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stack Bowls D435 -->
                    <div class="pcd-scene-camera-group" data-scene="stackbowl" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Stack Bowls Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-stackbowl-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-raw" data-ply-path="pcds/stackbowl_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="stackbowl" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-model-a" data-ply-path="pcds/stackbowl_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="stackbowl" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-model-b" data-ply-path="pcds/stackbowl_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-D435</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Place Toothpaste D435 -->
                    <div class="pcd-scene-camera-group" data-scene="toothpaste" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Place Toothpaste Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-toothpaste-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-raw" data-ply-path="pcds/toothpaste_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="toothpaste" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-model-a" data-ply-path="pcds/toothpaste_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="toothpaste" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-model-b" data-ply-path="pcds/toothpaste_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-D435</p>
                            </div>
                        </div>
                    </div>
                </div> <!-- End of pcd-dynamic-display -->
            </div>  
            
            <div class="table-section">
                <h3>Depth Evaluation on the <a href="https://github.com/Junggy/HAMMER-dataset" style="color: #103961;" target="_blank">Hammer Dataset</a> (Zero-Shot)</h3>
                <p>* denotes the model fine-tuning on the same synthesized data as CDMs.</p>
                <div class="table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Split</th>
                                <th rowspan="2">Depth Model</th>
                                <th>L1 â†“</th>
                                <th>RMSE â†“</th>
                                <th>AbsRel â†“</th>
                                <th>Î´â‚€.â‚… â†‘</th>
                                <th>Î´â‚ â†‘</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="header-row">
                                <td rowspan="7">D435<br>(IR Stereo)</td>
                                <td class="best-result"><strong>CDM-D435 (Ours)</strong></td>
                                <td class="best-result"><strong>0.0258</strong></td>
                                <td class="best-result"><strong>0.0404</strong></td>
                                <td class="best-result"><strong>0.0312</strong></td>
                                <td class="best-result"><strong>0.9842</strong></td>
                                <td class="best-result"><strong>0.9951</strong></td>
                            </tr>
                            <tr>
                                <td class="best-result"><strong>CDM-L515 (Ours)</strong></td>
                                <td class="best-result"><strong>0.0182</strong></td>
                                <td class="best-result"><strong>0.0338</strong></td>
                                <td class="best-result"><strong>0.0217</strong></td>
                                <td class="best-result"><strong>0.9877</strong></td>
                                <td class="best-result"><strong>0.9956</strong></td>
                            </tr>
                            <tr>
                                <td>PromptDA*(435)</td>
                                <td>0.0434</td>
                                <td>0.0666</td>
                                <td>0.0599</td>
                                <td>0.9459</td>
                                <td>0.9770</td>
                            </tr>
                            <tr>
                                <td>PromptDA*(515)</td>
                                <td>0.1830</td>
                                <td>0.2387</td>
                                <td>0.2750</td>
                                <td>0.8802</td>
                                <td>0.9186</td>
                            </tr>
                            <tr>
                                <td>PromptDA</td>
                                <td>0.0396</td>
                                <td>0.0691</td>
                                <td>0.0484</td>
                                <td>0.9503</td>
                                <td>0.9772</td>
                            </tr>
                            <tr>
                                <td>PriorDA</td>
                                <td>0.0388</td>
                                <td>0.0754</td>
                                <td>0.0461</td>
                                <td>0.9632</td>
                                <td>0.9880</td>
                            </tr>
                            <tr>
                                <td>Raw Depth</td>
                                <td>0.0550</td>
                                <td>0.1458</td>
                                <td>0.0708</td>
                                <td>0.9179</td>
                                <td>0.9543</td>
                            </tr>
                            
                            <tr class="header-row">
                                <td rowspan="7">L515<br>(D-ToF)</td>
                                <td class="best-result"><strong>CDM-L515 (Ours)</strong></td>
                                <td class="best-result"><strong>0.0156</strong></td>
                                <td class="best-result"><strong>0.0297</strong></td>
                                <td class="best-result"><strong>0.0229</strong></td>
                                <td class="best-result"><strong>0.9754</strong></td>
                                <td class="best-result"><strong>0.9919</strong></td>
                            </tr>
                            <tr>
                                <td class="best-result"><strong>CDM-D435 (Ours)</strong></td>
                                <td class="best-result"><strong>0.0165</strong></td>
                                <td class="best-result"><strong>0.0349</strong></td>
                                <td class="best-result"><strong>0.0246</strong></td>
                                <td class="best-result"><strong>0.9613</strong></td>
                                <td class="best-result"><strong>0.9855</strong></td>
                            </tr>
                            <tr>
                                <td>PromptDA*(515)</td>
                                <td>0.0235</td>
                                <td>0.0666</td>
                                <td>0.0349</td>
                                <td>0.9291</td>
                                <td>0.9730</td>
                            </tr>
                            <tr>
                                <td>PromptDA*(435)</td>
                                <td>0.0254</td>
                                <td>0.0438</td>
                                <td>0.0379</td>
                                <td>0.9234</td>
                                <td>0.9640</td>
                            </tr>
                            <tr>
                                <td>PromptDA</td>
                                <td>0.0207</td>
                                <td>0.0515</td>
                                <td>0.0304</td>
                                <td>0.9480</td>
                                <td>0.9699</td>
                            </tr>
                            <tr>
                                <td>PriorDA</td>
                                <td>0.0177</td>
                                <td>0.0385</td>
                                <td>0.0274</td>
                                <td>0.9502</td>
                                <td>0.9763</td>
                            </tr>
                            <tr>
                                <td>Raw Depth</td>
                                <td>0.0312</td>
                                <td>0.0813</td>
                                <td>0.0475</td>
                                <td>0.9098</td>
                                <td>0.9429</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="result-section">
            <h3>Depth Accuracy w.r.t Distance</h3>
            <p style="margin-bottom: 20px; color: #666;">To understand the working range of CDMs and help users effectively use them, we evaluated the depth accuracy of CDMs at various distances on the Hammer dataset. The results show that CDMs achieve high accuracy across different distances, with performance trends following the original camera capabilities while significantly reducing noise and errors.</p>
            <!-- Dataset Selector Buttons -->
            <div class="accuracy-selector-container">
                <div class="selector-group">
                    <span class="selector-label">Dataset Split:</span>
                    <div class="selector-buttons" id="dataset-selector">
                        <button class="selector-btn active" data-dataset="d435">D435</button>
                        <button class="selector-btn" data-dataset="l515">L515</button>
                        <button class="selector-btn" data-dataset="helios">Helios</button>
                    </div>
                </div>
            </div>
            
            <div id="accuracy-charts-container">
                <!-- D435 Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="d435">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">D435 Split - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="d435-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">D435 Split - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="d435-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- L515 Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="l515" style="display: none;">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">L515 Split - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="l515-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">L515 Split - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="l515-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Helios Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="helios" style="display: none;">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">Helios Split - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="helios-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">Helios Split - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="helios-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="accuracy-insights">
                <h3>Observations</h3>
                <ul></ul>
                    <li>Raw depth shows larger errors than manufacturer specifications (may be dataset bias)</li>
                    <li>CDMs maintain high accuracy within the camera's optimal working range</li>
                    <li>Performance trends follow the original camera capabilities while significantly reducing noise</li>
                </ul>
            </div>
            </div>

        <!-- ByteCamDepth Dataset Point Cloud Samples -->
        <section id="point-cloud-comparison" class="results-section">
            <div class="container">
                <div class="result-section">
                <h3>Point Cloud Quality Comparison on ByteCamDepth Dataset</h3>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">Interactive 3D visualization of CDM processed point clouds from ByteCamDepth dataset</p>
                
                <!-- Scene and Camera Selection Buttons -->
                <div class="pcd-selector-container">
                    <div class="selector-group">
                        <span class="selector-label">Scene:</span>
                        <div class="selector-buttons" id="bytecam-scene-selector">
                            <button class="selector-btn active" data-scene="living">Living</button>
                            <button class="selector-btn" data-scene="kitchen">Kitchen</button>
                            <button class="selector-btn" data-scene="bedroom">Bedroom</button>
                            <button class="selector-btn" data-scene="bathroom">Bathroom</button>
                            <button class="selector-btn" data-scene="office">Office</button>
                            <button class="selector-btn" data-scene="market">Market</button>
                            <button class="selector-btn" data-scene="breakroom">Break Room</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Camera:</span>
                        <div class="selector-buttons" id="bytecam-camera-selector">
                            <button class="selector-btn active" data-camera="d405">D405</button>
                            <button class="selector-btn" data-camera="d435">D435</button>
                            <button class="selector-btn" data-camera="l515">L515</button>
                            <button class="selector-btn" data-camera="kinect">Kinect</button>
                            <button class="selector-btn" data-camera="zed2i_neural">ZED2i-N.</button>
                            <button class="selector-btn" data-camera="zed2i_quality">ZED2i-Q.</button>
                        </div>
                    </div>
                </div>
                
                <!-- ByteCamDepth Debug Info Panel (only visible in debug mode) -->
                <div id="bytecam-debug-panel" class="debug-panel" style="display: none;">
                    <h4>ByteCamDepth Camera View Parameters (Debug Mode)</h4>
                    <div class="debug-content">
                        <div class="debug-viewer-info">
                            <h5>Raw Depth Viewer</h5>
                            <div class="debug-params">
                                <div>Position: <span id="bytecam-debug-raw-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="bytecam-debug-raw-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-viewer-info">
                            <h5>CDM Predicted Viewer</h5>
                            <div class="debug-params">
                                <div>Position: <span id="bytecam-debug-pred-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="bytecam-debug-pred-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-scene-info">
                            <small>Scene: <span id="bytecam-debug-scene">Living</span> | Camera: <span id="bytecam-debug-camera">D405</span></small>
                        </div>
                    </div>
                </div>
                    
                <div class="pcd-grid" style="max-width: 1400px; margin: 30px auto; grid-template-columns: repeat(2, 1fr); margin-bottom: 5px;">
                    <!-- Raw Depth Point Cloud -->
                    <div class="pcd-item">
                        <div class="pcd-lazy-container" id="bytecam-raw-container" data-viewer-id="bytecam-raw-viewer" data-ply-path="pcds_dataset/camera_d405/living_depth_0.ply" data-is-l515="false" style="height: 300px;">
                            <img class="pcd-placeholder" src="screenshots_dataset/d405_living_raw.png" alt="Loading..." style="display: block;">
                            <button class="load-interactive-btn" data-type="raw">Interactive View</button>
                            <div id="bytecam-raw-viewer" class="pcd-viewer-optimized" style="display: none;">
                                <div class="pcd-loading">Initializing viewer...</div>
                            </div>
                        </div>
                        <p>Raw Depth Point Cloud</p>
                    </div>
                    
                    <!-- CDM Predicted Point Cloud -->
                    <div class="pcd-item">
                        <div class="pcd-lazy-container" id="bytecam-pred-container" data-viewer-id="bytecam-pred-viewer" data-ply-path="pcds_dataset/camera_d405/living_depth_0_pred.ply" data-is-l515="false" style="height: 300px;">
                            <img class="pcd-placeholder" src="screenshots_dataset/d405_living_pred.png" alt="Loading..." style="display: block;">
                            <button class="load-interactive-btn" data-type="pred">Interactive View</button>
                            <div id="bytecam-pred-viewer" class="pcd-viewer-optimized" style="display: none;">
                                <div class="pcd-loading">Initializing viewer...</div>
                            </div>
                        </div>
                        <p id="bytecam-cdm-label">CDM-D405 Point Cloud</p>
                    </div>
                </div>
                
                <!-- Point Cloud Viewers and RGB Image -->
                <div class="pcd-grid" style="max-width: 500px; margin: 30px auto; grid-template-columns: repeat(1, 1fr); margin-top: 0px;">
                    <!-- RGB Image -->
                    <div class="pcd-item">
                        <div style="display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px;">
                            <img id="bytecam-rgb-image" src="pcds_dataset/camera_d405/living_rgb_0.png" alt="RGB Image" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px;">
                        </div>
                        <p>RGB Image</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </div>
    </section>

    <section class="method">
        <div class="container">
            <h2>Method Overview</h2>
            <div class="method-grid">
                <div class="method-item">
                    <h3>Neural Data Engine</h3>
                    <p>We model depth camera noise patterns to generate high-quality paired data from simulation for training CDMs.</p>
                    <img src="figs/sensor_depth_generation.svg" alt="Scene Depth Generation" style="max-width: 500px; width: 100%; margin-top: 30px;">
                </div>
                <div class="method-item">
                    <img src="figs/camera_depth_model.svg" alt="Camera Depth Model" style="max-width: 500px; width: 100%;">
                    <h3>Camera Depth Models (CDMs)</h3>
                    <p>CDMs process RGB images and noisy depth signals from specific depth cameras to produce high-quality, denoised metric depth.</p>
                </div>
            </div>
        </div>
    </section>


    <section class="citation">
        <div class="container">
            <h2>Citation</h2>
            <pre><code>@article{liu2024manipulation,
  title={Manipulation as in Simulation: Enabling Accurate Geometry Perception in Robots},
  author={Liu, Minghuan and Zhu, Zhengbang and Han, Xiaoshen and Hu, Peng and Lin, Haotong and 
          Li, Xinyao and Chen, Jingxiao and Xu, Jiafeng and Yang, Yichu and Lin, Yunfeng and 
          Li, Xinghang and Yu, Yong and Zhang, Weinan and Kong, Tao and Kang, Bingyi},
  journal={arXiv preprint},
  year={2024}
}</code></pre>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>Â© 2024 ByteDance Seed. All rights reserved.</p>
            <p>Correspondence: <a href="mailto:ericliuof97@gmail.com">Minghuan Liu</a>, <a href="mailto:bingyikang@bytedance.com">Bingyi Kang</a></p>
        </div>
    </footer>

    <style>
        /* Video comparison styles */
        .bal-container-small {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .bal-after {
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        
        .bal-after video {
            width: 100%;
            display: block;
        }
        
        .bal-before {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            z-index: 15;
            overflow: hidden;
        }
        
        .bal-container-small .bal-before-inset {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            /* Width will be set by JS to match container */
        }
        
        .bal-container-small .bal-before-inset video {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .bal-handle {
            position: absolute;
            top: 0;
            height: 100%;
            width: 4px;
            background: white;
            cursor: ew-resize;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 20;
        }
        
        .bal-handle::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        .handle-left-arrow,
        .handle-right-arrow {
            position: absolute;
            top: 50%;
            width: 0;
            height: 0;
            border-style: solid;
            z-index: 21;
        }
        
        .handle-left-arrow {
            left: -8px;
            transform: translateY(-50%);
            border-width: 6px 6px 6px 0;
            border-color: transparent #333 transparent transparent;
        }
        
        .handle-right-arrow {
            right: -8px;
            transform: translateY(-50%);
            border-width: 6px 0 6px 6px;
            border-color: transparent transparent transparent #333;
        }
        
        .bal-beforePosition,
        .bal-afterPosition {
            background: #121212;
            color: #fff;
            pointer-events: none;
            border-radius: 0.2rem;
            padding: 2px 10px;
            position: absolute;
            top: 10px;
            z-index: 10;
        }
        
        .bal-beforePosition {
            left: 10px;
        }
        
        .bal-afterPosition {
            right: 10px;
        }
    </style>
    
    <script>
        // Point Cloud Scene and Camera Selector
        document.addEventListener('DOMContentLoaded', function() {
            const sceneButtons = document.querySelectorAll('#scene-selector .selector-btn');
            const cameraButtons = document.querySelectorAll('#camera-selector .selector-btn');
            const modelAButtons = document.querySelectorAll('#model-a-selector .selector-btn');
            const modelBButtons = document.querySelectorAll('#model-b-selector .selector-btn');
            const pcdGroups = document.querySelectorAll('.pcd-scene-camera-group');
            
            // Flag to track if this is the initial page load
            let isInitialLoad = true;
            
            // Model path mapping
            const modelPathMap = {
                'kitchen': {
                    '435': {
                        '435': 'pcds/microwave_435_model_435_depth.ply',
                        '515': 'pcds/microwave_435_model_515_depth.ply', 
                        'priorda': 'pcds/microwave_435_model_priorda_depth.ply',
                        'promptda': 'pcds/microwave_435_model_promptda_depth.ply'
                    },
                    '515': {
                        '435': 'pcds/microwave_515_model_435_depth.ply',
                        '515': 'pcds/microwave_515_model_depth.ply',
                        'priorda': 'pcds/microwave_515_model_priorda_depth.ply',
                        'promptda': 'pcds/microwave_515_model_promptda_depth.ply'
                    }
                },
                'canteen': {
                    '435': {
                        '435': 'pcds/canteen_435_model_435_depth.ply',
                        '515': 'pcds/canteen_435_model_515_depth.ply',
                        'priorda': 'pcds/canteen_435_model_priorda_depth.ply',
                        'promptda': 'pcds/canteen_435_model_promptda_depth.ply'
                    },
                    '515': {
                        '435': 'pcds/canteen_515_model_435_depth.ply',
                        '515': 'pcds/canteen_515_model_515_depth.ply',
                        'priorda': 'pcds/canteen_515_model_priorda_depth.ply',
                        'promptda': 'pcds/canteen_515_model_promptda_depth.ply'
                    }
                },
                'stackbowl': {
                    '435': {
                        '435': 'pcds/stackbowl_435_model_435_depth.ply',
                        '515': 'pcds/stackbowl_435_model_515_depth.ply',
                        'priorda': 'pcds/stackbowl_435_model_priorda_depth.ply',
                        'promptda': 'pcds/stackbowl_435_model_promptda_depth.ply'
                    }
                },
                'toothpaste': {
                    '435': {
                        '435': 'pcds/toothpaste_435_model_435_depth.ply',
                        '515': 'pcds/toothpaste_435_model_515_depth.ply',
                        'priorda': 'pcds/toothpaste_435_model_priorda_depth.ply',
                        'promptda': 'pcds/toothpaste_435_model_promptda_depth.ply'
                    }
                }
            };
            
            // Model display names
            const modelNames = {
                '435': 'CDM-D435',
                '515': 'CDM-L515',
                'priorda': 'PriorDA',
                'promptda': 'PromptDA'
            };
            
            function updatePointCloudDisplay() {
                // Get active selections
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active').dataset.camera;
                const activeModelA = document.querySelector('#model-a-selector .selector-btn.active').dataset.model;
                const activeModelB = document.querySelector('#model-b-selector .selector-btn.active').dataset.model;
                
                // Before hiding groups, dispose any active viewers in the groups being hidden
                pcdGroups.forEach(group => {
                    // If this group is currently visible and will be hidden
                    if (group.style.display !== 'none' && 
                        (group.dataset.scene !== activeScene || group.dataset.camera !== activeCamera)) {
                        // Find all loaded viewers in this group
                        const containers = group.querySelectorAll('.pcd-lazy-container');
                        containers.forEach(container => {
                            const viewerId = container.dataset.viewerId;
                            // Check if viewer exists in global loadedViewers object
                            if (window.loadedViewers && window.loadedViewers[viewerId]) {
                                // Dispose the viewer
                                if (window.loadedViewers[viewerId].dispose) {
                                    window.loadedViewers[viewerId].dispose();
                                }
                                delete window.loadedViewers[viewerId];
                                
                                // Reset the container to show placeholder
                                const placeholder = container.querySelector('.pcd-placeholder');
                                const button = container.querySelector('.load-interactive-btn');
                                const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                                
                                if (placeholder) placeholder.style.display = 'block';
                                if (button) button.style.display = 'block';
                                if (viewerDiv) viewerDiv.style.display = 'none';
                            }
                        });
                    }
                    group.style.display = 'none';
                });
                
                // Show the selected group
                const selectedGroup = document.querySelector(`.pcd-scene-camera-group[data-scene="${activeScene}"][data-camera="${activeCamera}"]`);
                if (selectedGroup) {
                    selectedGroup.style.display = 'block';
                    
                    // Only update if not initial load OR if models have changed
                    if (!isInitialLoad) {
                        // Update Model A viewer
                        const modelAViewer = selectedGroup.querySelector('.model-a-viewer');
                        if (modelAViewer) {
                            const modelAContainer = modelAViewer.querySelector('.pcd-lazy-container');
                            const modelALabel = modelAViewer.querySelector('p');
                            
                            if (modelPathMap[activeScene] && 
                                modelPathMap[activeScene][activeCamera] && 
                                modelPathMap[activeScene][activeCamera][activeModelA]) {
                                
                                const newPath = modelPathMap[activeScene][activeCamera][activeModelA];
                                const viewerId = modelAContainer.dataset.viewerId;
                                const currentPath = modelAContainer.dataset.plyPath;
                                
                                // Only update if path actually changed
                                if (currentPath !== newPath) {
                                    // Update the data attribute
                                    modelAContainer.dataset.plyPath = newPath;
                                    
                                    // Update label
                                    modelALabel.textContent = `Model A: ${modelNames[activeModelA]}`;
                                    
                                    // Update placeholder image
                                    const placeholder = modelAContainer.querySelector('.pcd-placeholder');
                                    const button = modelAContainer.querySelector('.load-interactive-btn');
                                    const viewerDiv = modelAContainer.querySelector('.pcd-viewer-optimized');
                                    
                                    if (placeholder) {
                                        const imagePath = newPath.replace('pcds/', 'screenshots/').replace('.ply', '.png');
                                        placeholder.src = imagePath;
                                    }
                                    
                                    // If a viewer is currently loaded, dispose it and reset
                                    if (window.loadedViewers[viewerId]) {
                                        if (window.loadedViewers[viewerId].dispose) {
                                            window.loadedViewers[viewerId].dispose();
                                        }
                                        delete window.loadedViewers[viewerId];
                                        
                                        // Reset to show placeholder and button
                                        if (placeholder) placeholder.style.display = 'block';
                                        if (button) button.style.display = 'block';
                                        if (viewerDiv) viewerDiv.style.display = 'none';
                                    }
                                }
                            }
                        }
                        
                        // Update Model B viewer
                        const modelBViewer = selectedGroup.querySelector('.model-b-viewer');
                        if (modelBViewer) {
                            const modelBContainer = modelBViewer.querySelector('.pcd-lazy-container');
                            const modelBLabel = modelBViewer.querySelector('p');
                            
                            if (modelPathMap[activeScene] && 
                                modelPathMap[activeScene][activeCamera] && 
                                modelPathMap[activeScene][activeCamera][activeModelB]) {
                                
                                const newPath = modelPathMap[activeScene][activeCamera][activeModelB];
                                const viewerId = modelBContainer.dataset.viewerId;
                                const currentPath = modelBContainer.dataset.plyPath;
                                
                                // Only update if path actually changed
                                if (currentPath !== newPath) {
                                    // Update the data attribute
                                    modelBContainer.dataset.plyPath = newPath;
                                    
                                    // Update label
                                    modelBLabel.textContent = `Model B: ${modelNames[activeModelB]}`;
                                    
                                    // Update placeholder image
                                    const placeholder = modelBContainer.querySelector('.pcd-placeholder');
                                    const button = modelBContainer.querySelector('.load-interactive-btn');
                                    const viewerDiv = modelBContainer.querySelector('.pcd-viewer-optimized');
                                    
                                    if (placeholder) {
                                        const imagePath = newPath.replace('pcds/', 'screenshots/').replace('.ply', '.png');
                                        placeholder.src = imagePath;
                                    }
                                    
                                    // If a viewer is currently loaded, dispose it and reset
                                    if (window.loadedViewers[viewerId]) {
                                        if (window.loadedViewers[viewerId].dispose) {
                                            window.loadedViewers[viewerId].dispose();
                                        }
                                        delete window.loadedViewers[viewerId];
                                        
                                        // Reset to show placeholder and button
                                        if (placeholder) placeholder.style.display = 'block';
                                        if (button) button.style.display = 'block';
                                        if (viewerDiv) viewerDiv.style.display = 'none';
                                    }
                                }
                            }
                        }
                    }
                    
                    // After first call, no longer initial load
                    if (isInitialLoad) {
                        isInitialLoad = false;
                    }
                }
            }
            
            function updateCameraAvailability() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const l515Button = document.querySelector('#camera-selector .selector-btn[data-camera="515"]');
                const d435Button = document.querySelector('#camera-selector .selector-btn[data-camera="435"]');
                
                // Disable L515 for Stack Bowls and Place Toothpaste scenes
                if (activeScene === 'stackbowl' || activeScene === 'toothpaste') {
                    l515Button.disabled = true;
                    l515Button.style.opacity = '0.5';
                    l515Button.style.cursor = 'not-allowed';
                    
                    // If L515 is currently selected, switch to D435
                    if (l515Button.classList.contains('active')) {
                        l515Button.classList.remove('active');
                        d435Button.classList.add('active');
                    }
                } else {
                    l515Button.disabled = false;
                    l515Button.style.opacity = '1';
                    l515Button.style.cursor = 'pointer';
                }
            }
            
            function updateSceneAvailability() {
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active').dataset.camera;
                const stackBowlButton = document.querySelector('#scene-selector .selector-btn[data-scene="stackbowl"]');
                const toothpasteButton = document.querySelector('#scene-selector .selector-btn[data-scene="toothpaste"]');
                const kitchenButton = document.querySelector('#scene-selector .selector-btn[data-scene="kitchen"]');
                const canteenButton = document.querySelector('#scene-selector .selector-btn[data-scene="canteen"]');
                
                // Disable Stack Bowls and Place Toothpaste scenes when L515 is selected
                if (activeCamera === '515') {
                    stackBowlButton.disabled = true;
                    stackBowlButton.style.opacity = '0.5';
                    stackBowlButton.style.cursor = 'not-allowed';
                    
                    toothpasteButton.disabled = true;
                    toothpasteButton.style.opacity = '0.5';
                    toothpasteButton.style.cursor = 'not-allowed';
                    
                    // If Stack Bowls or Toothpaste is currently selected, switch to Kitchen
                    const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                    if (activeScene === 'stackbowl' || activeScene === 'toothpaste') {
                        document.querySelector('#scene-selector .selector-btn.active').classList.remove('active');
                        kitchenButton.classList.add('active');
                    }
                } else {
                    stackBowlButton.disabled = false;
                    stackBowlButton.style.opacity = '1';
                    stackBowlButton.style.cursor = 'pointer';
                    
                    toothpasteButton.disabled = false;
                    toothpasteButton.style.opacity = '1';
                    toothpasteButton.style.cursor = 'pointer';
                }
            }
            
            function updateModelAvailability() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active')?.dataset.camera;
                
                // Get all model buttons
                const modelA515 = document.querySelector('#model-a-selector .selector-btn[data-model="515"]');
                const modelAPriorDA = document.querySelector('#model-a-selector .selector-btn[data-model="priorda"]');
                const modelAPromptDA = document.querySelector('#model-a-selector .selector-btn[data-model="promptda"]');
                const modelA435 = document.querySelector('#model-a-selector .selector-btn[data-model="435"]');
                
                const modelB515 = document.querySelector('#model-b-selector .selector-btn[data-model="515"]');
                const modelBPriorDA = document.querySelector('#model-b-selector .selector-btn[data-model="priorda"]');
                const modelBPromptDA = document.querySelector('#model-b-selector .selector-btn[data-model="promptda"]');
                const modelB435 = document.querySelector('#model-b-selector .selector-btn[data-model="435"]');
                
                // Enable all models for all scenes now that stackbowl and toothpaste have all models
                [modelA515, modelAPriorDA, modelAPromptDA, modelA435, modelB515, modelBPriorDA, modelBPromptDA, modelB435].forEach(btn => {
                    if (btn) {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                    }
                });
            }
            
            // Add click handlers for scene buttons
            sceneButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    sceneButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateCameraAvailability();
                    updateModelAvailability();
                    updatePointCloudDisplay();
                    // Update debug info if in debug mode
                    if (typeof updateDebugSceneInfo === 'function') {
                        updateDebugSceneInfo();
                    }
                });
            });
            
            // Add click handlers for camera buttons
            cameraButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    cameraButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateSceneAvailability();
                    updateModelAvailability();
                    updatePointCloudDisplay();
                    // Update debug info if in debug mode
                    if (typeof updateDebugSceneInfo === 'function') {
                        updateDebugSceneInfo();
                    }
                });
            });
            
            // Add click handlers for Model A buttons
            modelAButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    modelAButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updatePointCloudDisplay();
                });
            });
            
            // Add click handlers for Model B buttons
            modelBButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    modelBButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updatePointCloudDisplay();
                });
            });
            
            // Initialize display
            updateCameraAvailability();
            updateSceneAvailability();
            updateModelAvailability();
            updatePointCloudDisplay();
            
            // Function to update debug scene info
            function updateDebugSceneInfo() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active')?.dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active')?.dataset.camera;
                
                const sceneElement = document.getElementById('debug-scene');
                const cameraElement = document.getElementById('debug-camera');
                
                if (sceneElement) {
                    sceneElement.textContent = activeScene ? activeScene.charAt(0).toUpperCase() + activeScene.slice(1) : '-';
                }
                if (cameraElement) {
                    cameraElement.textContent = activeCamera ? `D${activeCamera}` : '-';
                }
            }
            
            // Depth Accuracy Dataset Selector
            const datasetButtons = document.querySelectorAll('#dataset-selector .selector-btn');
            const datasetGroups = document.querySelectorAll('.accuracy-dataset-group');
            
            function updateAccuracyDisplay() {
                // Get active dataset
                const activeDataset = document.querySelector('#dataset-selector .selector-btn.active')?.dataset.dataset;
                
                if (!activeDataset) return;
                
                // Hide all groups
                datasetGroups.forEach(group => {
                    group.style.display = 'none';
                });
                
                // Show the selected group
                const selectedGroup = document.querySelector(`.accuracy-dataset-group[data-dataset="${activeDataset}"]`);
                if (selectedGroup) {
                    selectedGroup.style.display = 'block';
                    
                    // Trigger chart redraw if needed (Chart.js specific)
                    const charts = selectedGroup.querySelectorAll('canvas');
                    charts.forEach(canvas => {
                        const chartInstance = Chart.getChart(canvas.id);
                        if (chartInstance) {
                            chartInstance.resize();
                        }
                    });
                }
            }
            
            // Add click handlers for dataset buttons
            datasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    datasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateAccuracyDisplay();
                });
            });
            
            // Initialize accuracy display
            updateAccuracyDisplay();
            
            // ByteCamDepth Dataset Image Selector
            const cameraDatasetButtons = document.querySelectorAll('#camera-dataset-selector .selector-btn');
            const sceneDatasetButtons = document.querySelectorAll('#scene-dataset-selector .selector-btn');
            const pairDatasetButtons = document.querySelectorAll('#pair-dataset-selector .selector-btn');
            const rgbImage = document.getElementById('dataset-rgb-image');
            const depthImage = document.getElementById('dataset-depth-image');
            
            // Camera folder mappings
            const cameraFolderMap = {
                'd405': 'camera_d405',
                'd415': 'camera_d415',
                'd435': 'camera_d435',
                'd455': 'camera_d455',
                'l515': 'camera_l515',
                'kinect': 'camera_kinect',
                'zed2i_neural': 'camera_zed2i_neural',
                'zed2i_ultra': 'camera_zed2i_ultra',
                'zed2i_quality': 'camera_zed2i_quality',
                'zed2i_performance': 'camera_zed2i_performance'
            };
            
            // Scene file mappings
            const sceneFileMap = {
                'living': 'living',
                'kitchen': 'kitchen',
                'bedroom': 'bedroom',
                'bathroom': 'bathroom',
                'office': 'office',
                'market': 'market',
                'BreakRoom': 'BreakRoom'
            };
            
            function updateDatasetImages() {
                const activeCamera = document.querySelector('#camera-dataset-selector .selector-btn.active')?.dataset.camera;
                const activeScene = document.querySelector('#scene-dataset-selector .selector-btn.active')?.dataset.scene;
                const activePair = document.querySelector('#pair-dataset-selector .selector-btn.active')?.dataset.pair;
                
                if (!activeCamera || !activeScene || activePair === undefined) return;
                
                const cameraFolder = cameraFolderMap[activeCamera];
                const sceneFile = sceneFileMap[activeScene];
                
                if (cameraFolder && sceneFile) {
                    const basePath = `figs/rgb_depth/${cameraFolder}/`;
                    rgbImage.src = `${basePath}${sceneFile}_rgb_${activePair}.png`;
                    depthImage.src = `${basePath}${sceneFile}_depth_${activePair}.png`;
                    
                    // Add fade effect
                    rgbImage.style.opacity = '0';
                    depthImage.style.opacity = '0';
                    
                    setTimeout(() => {
                        rgbImage.style.opacity = '1';
                        depthImage.style.opacity = '1';
                    }, 50);
                }
            }
            
            // Add click handlers for camera dataset buttons
            cameraDatasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    cameraDatasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDatasetImages();
                });
            });
            
            // Add click handlers for scene dataset buttons
            sceneDatasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    sceneDatasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDatasetImages();
                });
            });
            
            // Add click handlers for pair dataset buttons
            pairDatasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    pairDatasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDatasetImages();
                });
            });
            
            // Initialize dataset images
            updateDatasetImages();
            
            // Draw Spectral colormap
            function drawSpectralColormap() {
                const canvas = document.getElementById('spectral-colormap');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const width = canvas.width;
                const height = canvas.height;
                
                // Create gradient matching matplotlib's Spectral colormap
                const gradient = ctx.createLinearGradient(0, 0, width, 0);
                
                // Spectral colormap colors (from matplotlib)
                // Goes from red (near) to purple (far)
                gradient.addColorStop(0.0, '#9e0142');    // Dark red
                gradient.addColorStop(0.1, '#d53e4f');    // Red
                gradient.addColorStop(0.2, '#f46d43');    // Orange-red
                gradient.addColorStop(0.3, '#fdae61');    // Orange
                gradient.addColorStop(0.4, '#fee08b');    // Yellow-orange
                gradient.addColorStop(0.5, '#ffffbf');    // Yellow
                gradient.addColorStop(0.6, '#e6f598');    // Yellow-green
                gradient.addColorStop(0.7, '#abdda4');    // Green
                gradient.addColorStop(0.8, '#66c2a5');    // Cyan-green
                gradient.addColorStop(0.9, '#3288bd');    // Blue
                gradient.addColorStop(1.0, '#5e4fa2');    // Purple
                
                // Fill the canvas with the gradient
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);
            }
            
            // Draw colormap on page load
            drawSpectralColormap();
        });
        
        // Optimized Point Cloud Viewer for 90k+ points
        class OptimizedPointCloudViewer {
            constructor(containerId, plyPath, isL515 = false, captureMode = false, debugMode = false) {
                this.container = document.getElementById(containerId);
                this.plyPath = plyPath;
                this.currentLOD = null;
                this.isLoading = true;
                this.isL515 = isL515; // Flag to use different camera settings for L515
                this.captureMode = captureMode; // Flag for screenshot capture mode
                this.debugMode = debugMode; // Flag for debug mode
                this.viewerId = containerId; // Store viewer ID for tracking
                
                // Point cloud visualization settings
                this.pointSize = 0.02; // Adjust this value to change point size
                
                this.init();
            }
            
            captureScreenshot() {
                // Force update controls
                this.controls.update();
                
                // Ensure the scene is rendered one more time
                this.renderer.render(this.scene, this.camera);
                
                // Get the canvas
                const canvas = this.renderer.domElement;
                
                // Check if canvas has content
                if (canvas.width === 0 || canvas.height === 0) {
                    console.error('Canvas has no dimensions');
                    return null;
                }
                
                // Capture the canvas as data URL with preserveDrawingBuffer
                const dataURL = canvas.toDataURL('image/png', 1.0);
                
                // Extract filename from ply path
                const filename = this.plyPath.split('/').pop().replace('.ply', '.png');
                
                if (this.captureMode) {
                    // Check if the image is not empty
                    if (dataURL && dataURL.length > 100) {
                        // Auto-download in capture mode
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = dataURL;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log(`Screenshot captured: ${filename} (${dataURL.length} bytes)`);
                    } else {
                        console.error(`Failed to capture screenshot for ${filename}`);
                    }
                }
                
                return dataURL;
            }

            init() {
                if (!this.container) return;

                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf5f5f5);

                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    45,
                    this.container.clientWidth / this.container.clientHeight,
                    0.1,
                    1000
                );
                
                // Set camera position based on camera type
                if (this.isL515) {
                    // L515 camera position
                    this.camera.position.set(0.278, 1.856, 1.286);
                } else {
                    // D435 camera position (updated)
                    this.camera.position.set(-0.169, 1.908, 1.173);
                }
                
                // Set the up vector to ensure correct orientation
                this.camera.up.set(0, 1, 0);

                // Optimized renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: false, // Disable for better performance
                    powerPreference: "high-performance",
                    preserveDrawingBuffer: true // Required for screenshot capture
                });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5)); // Limit pixel ratio
                this.container.appendChild(this.renderer.domElement);

                // Controls with free rotation
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 0.5;
                this.controls.maxDistance = 10;
                
                // Set target based on camera type
                if (this.isL515) {
                    // L515 target
                    this.controls.target.set(-0.002, -0.351, 0.113);
                } else {
                    // D435 target (updated)
                    this.controls.target.set(-0.107, -0.351, 0.068);
                }
                this.controls.update();

                // Simple lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(ambientLight);

                // Load point cloud with LOD
                this.loadPointCloud();

                // Start render loop
                this.animate();

                // Handle resize
                window.addEventListener('resize', () => this.handleResize());
            }

            loadPointCloud() {
                const loadingDiv = this.container.querySelector('.pcd-loading');
                if (loadingDiv) {
                    loadingDiv.textContent = 'Loading point cloud...';
                }

                const loader = new THREE.PLYLoader();
                loader.load(
                    this.plyPath,
                    (geometry) => this.onGeometryLoaded(geometry),
                    (xhr) => {
                        if (xhr.lengthComputable && loadingDiv) {
                            const percentComplete = (xhr.loaded / xhr.total) * 100;
                            loadingDiv.textContent = `Loading: ${Math.round(percentComplete)}%`;
                        }
                    },
                    (error) => {
                        console.error('Error loading PLY:', error);
                        if (loadingDiv) {
                            loadingDiv.textContent = 'Failed to load. Please run a local server.';
                        }
                    }
                );
            }

            onGeometryLoaded(geometry) {
                const loadingDiv = this.container.querySelector('.pcd-loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }

                // Convert from Blender's Z-up to Three.js Y-up coordinate system
                // Rotate -90 degrees around X axis to swap Y and Z
                geometry.rotateX(-Math.PI / 2);

                // Center and scale
                geometry.computeBoundingBox();
                geometry.center();
                const size = new THREE.Vector3();
                geometry.boundingBox.getSize(size);
                const scale = 2 / Math.max(size.x, size.y, size.z);
                geometry.scale(scale, scale, scale);

                // Create point cloud with all points (highest quality)
                this.currentLOD = this.createPointCloud(geometry, 1.0);
                this.scene.add(this.currentLOD);
                
                this.isLoading = false;
                
                // Capture screenshot if in capture mode
                if (this.captureMode) {
                    console.log(`Point cloud loaded for ${this.plyPath}, preparing to capture...`);
                    // Need to wait for several animation frames to ensure proper rendering
                    let frameCount = 0;
                    const captureAfterFrames = () => {
                        frameCount++;
                        if (frameCount < 10) {
                            // Ensure we render a few frames first
                            this.renderer.render(this.scene, this.camera);
                            requestAnimationFrame(captureAfterFrames);
                        } else {
                            // Now capture the screenshot
                            console.log(`Capturing screenshot for ${this.plyPath}...`);
                            this.captureScreenshot();
                        }
                    };
                    requestAnimationFrame(captureAfterFrames);
                }
            }


            createPointCloud(geometry, pointSize) {
                // Add colors if not present
                if (!geometry.attributes.color) {
                    const positions = geometry.attributes.position.array;
                    const pointCount = positions.length / 3;
                    const colors = new Float32Array(pointCount * 3);
                    
                    for (let i = 0; i < pointCount; i++) {
                        const y = positions[i * 3 + 1];
                        const t = (y + 1) * 0.5;
                        colors[i * 3] = 0.1 + t * 0.3;
                        colors[i * 3 + 1] = 0.4 + t * 0.4;
                        colors[i * 3 + 2] = 0.8;
                    }
                    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                }

                const material = new THREE.PointsMaterial({
                    size: this.pointSize,
                    vertexColors: true,
                    sizeAttenuation: true
                });

                return new THREE.Points(geometry, material);
            }

            animate() {
                this.animationId = requestAnimationFrame(() => this.animate());

                // Always render for smooth interaction
                this.renderer.render(this.scene, this.camera);
                
                // Update camera info display in debug mode
                if (this.debugMode) {
                    this.updateCameraInfo();
                }
            }
            
            updateCameraInfo() {
                const pos = this.camera.position;
                const target = this.controls.target;
                
                // Determine which viewer this is based on the viewer ID
                const isRawViewer = this.viewerId.includes('raw');
                const isModelViewer = this.viewerId.includes('model');
                
                if (isRawViewer) {
                    // Update left viewer (raw depth) info
                    const posElement = document.getElementById('debug-left-pos');
                    const targetElement = document.getElementById('debug-left-target');
                    
                    if (posElement) {
                        posElement.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (targetElement) {
                        targetElement.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                } else if (isModelViewer) {
                    // Update right viewer (CDM output) info
                    const posElement = document.getElementById('debug-right-pos');
                    const targetElement = document.getElementById('debug-right-target');
                    
                    if (posElement) {
                        posElement.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (targetElement) {
                        targetElement.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                }
            }

            handleResize() {
                this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            }
            
            dispose() {
                // Cancel animation frame
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                
                // Dispose of Three.js resources
                if (this.currentLOD) {
                    if (this.currentLOD.geometry) {
                        this.currentLOD.geometry.dispose();
                    }
                    if (this.currentLOD.material) {
                        this.currentLOD.material.dispose();
                    }
                }
                
                // Dispose of renderer
                if (this.renderer) {
                    this.renderer.dispose();
                    if (this.renderer.domElement && this.renderer.domElement.parentNode) {
                        this.renderer.domElement.parentNode.removeChild(this.renderer.domElement);
                    }
                }
                
                // Dispose of controls
                if (this.controls) {
                    this.controls.dispose();
                }
                
                // Remove resize event listener
                window.removeEventListener('resize', () => this.handleResize());
                
                // Clear the container
                if (this.container) {
                    while (this.container.firstChild) {
                        this.container.removeChild(this.container.firstChild);
                    }
                    // Re-add the loading div for potential future use
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'pcd-loading';
                    loadingDiv.textContent = 'Initializing viewer...';
                    this.container.appendChild(loadingDiv);
                }
            }
        }

        // Initialize viewers when page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Check URL parameters for capture mode and debug mode
            const urlParams = new URLSearchParams(window.location.search);
            const captureMode = urlParams.get('capture') === 'true';
            const captureDatasetMode = urlParams.get('capture_dataset') === 'true';
            const debugMode = urlParams.get('debug') === 'true';
            
            // Show debug panel if in debug mode
            if (debugMode) {
                const debugPanel = document.getElementById('debug-panel');
                if (debugPanel) {
                    debugPanel.style.display = 'block';
                }
            }
            
            // Check if running locally
            const isLocal = window.location.protocol === 'file:';
            
            if (isLocal && !captureMode) {
                document.querySelectorAll('.pcd-loading').forEach(div => {
                    div.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <p>To view interactive point clouds:</p>
                            <p style="font-size: 12px;">Run: <code>python3 -m http.server 8000</code></p>
                            <p style="font-size: 12px;">Visit: <code>http://localhost:8000</code></p>
                        </div>
                    `;
                });
                // Still set up lazy loading for local mode
            }
            
            // Track loaded viewers (make it global for access from other functions)
            window.loadedViewers = window.loadedViewers || {};
            
            // Function to load a viewer on demand
            function loadViewer(container) {
                if (container.dataset.plyPath.includes("dataset")) {
                    // Handled below
                    return
                }
                
                const viewerId = container.dataset.viewerId;
                const plyPath = container.dataset.plyPath;
                const isL515 = container.dataset.isL515 === 'true';
                
                // Prevent duplicate loading
                if (window.loadedViewers[viewerId]) return;
                
                // Hide placeholder and button
                const placeholder = container.querySelector('.pcd-placeholder');
                const button = container.querySelector('.load-interactive-btn');
                const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                
                if (placeholder) placeholder.style.display = 'none';
                if (button) button.style.display = 'none';
                if (viewerDiv) viewerDiv.style.display = 'block';
                
                // Create the viewer with debug mode
                window.loadedViewers[viewerId] = new OptimizedPointCloudViewer(viewerId, plyPath, isL515, false, debugMode);
                
                // Update debug info with current scene and camera
                if (debugMode && typeof updateDebugSceneInfo === 'function') {
                    updateDebugSceneInfo();
                }
            }
            
            // Set up lazy loading buttons
            document.querySelectorAll('.load-interactive-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const container = this.closest('.pcd-lazy-container');
                    if (container) {
                        loadViewer(container);
                    }
                });
            });
            
            // If in capture mode, load all viewers immediately to capture screenshots
            if (captureMode) {
                console.log('Screenshot capture mode enabled');
                alert('Screenshot capture mode enabled. The page will automatically download screenshots of all point clouds.');
                
                // First, make ALL scene-camera groups visible so all viewers can be loaded
                document.querySelectorAll('.pcd-scene-camera-group').forEach(group => {
                    group.style.display = 'block';
                });
                
                // Then make all viewer containers visible
                document.querySelectorAll('.pcd-lazy-container').forEach(container => {
                    const placeholder = container.querySelector('.pcd-placeholder');
                    const button = container.querySelector('.load-interactive-btn');
                    const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                    
                    if (placeholder) placeholder.style.display = 'none';
                    if (button) button.style.display = 'none';
                    if (viewerDiv) viewerDiv.style.display = 'block';
                });
                
                // Create a hidden container for capture mode viewers
                const captureContainer = document.createElement('div');
                captureContainer.id = 'capture-container';
                captureContainer.style.position = 'absolute';
                captureContainer.style.left = '-9999px';
                captureContainer.style.width = '800px';
                captureContainer.style.height = '600px';
                document.body.appendChild(captureContainer);
                
                // Load all viewers with capture mode enabled
                // Note: Using setTimeout to stagger the loading slightly to prevent browser overload
                const viewerConfigs = [
                    // Kitchen (microwave) scenes
                    { id: 'capture-microwave-435-raw', path: 'pcds/microwave_435_raw_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-435', path: 'pcds/microwave_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-515', path: 'pcds/microwave_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-priorda', path: 'pcds/microwave_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-promptda', path: 'pcds/microwave_435_model_promptda_depth.ply', isL515: false },
                    { id: 'capture-microwave-515-raw', path: 'pcds/microwave_515_raw_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-435', path: 'pcds/microwave_515_model_435_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-515', path: 'pcds/microwave_515_model_515_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-priorda', path: 'pcds/microwave_515_model_priorda_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-promptda', path: 'pcds/microwave_515_model_promptda_depth.ply', isL515: true },
                    
                    // Canteen scenes
                    { id: 'capture-canteen-435-raw', path: 'pcds/canteen_435_raw_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-435', path: 'pcds/canteen_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-515', path: 'pcds/canteen_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-priorda', path: 'pcds/canteen_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-promptda', path: 'pcds/canteen_435_model_promptda_depth.ply', isL515: false },
                    { id: 'capture-canteen-515-raw', path: 'pcds/canteen_515_raw_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-435', path: 'pcds/canteen_515_model_435_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-515', path: 'pcds/canteen_515_model_515_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-priorda', path: 'pcds/canteen_515_model_priorda_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-promptda', path: 'pcds/canteen_515_model_promptda_depth.ply', isL515: true },
                    
                    // Stack Bowls scenes
                    { id: 'capture-stackbowl-435-raw', path: 'pcds/stackbowl_435_raw_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-435', path: 'pcds/stackbowl_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-515', path: 'pcds/stackbowl_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-priorda', path: 'pcds/stackbowl_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-promptda', path: 'pcds/stackbowl_435_model_promptda_depth.ply', isL515: false },
                    
                    // Toothpaste scenes
                    { id: 'capture-toothpaste-435-raw', path: 'pcds/toothpaste_435_raw_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-435', path: 'pcds/toothpaste_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-515', path: 'pcds/toothpaste_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-priorda', path: 'pcds/toothpaste_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-promptda', path: 'pcds/toothpaste_435_model_promptda_depth.ply', isL515: false }
                ];
                
                // Create viewer divs and load all viewers
                viewerConfigs.forEach((config, index) => {
                    // Create a div for each viewer
                    const viewerDiv = document.createElement('div');
                    viewerDiv.id = config.id;
                    viewerDiv.style.width = '800px';
                    viewerDiv.style.height = '600px';
                    captureContainer.appendChild(viewerDiv);
                    
                    // Stagger loading by 200ms each to prevent browser overload
                    setTimeout(() => {
                        console.log(`Loading viewer ${index + 1}/${viewerConfigs.length}: ${config.path}`);
                        new OptimizedPointCloudViewer(config.id, config.path, config.isL515, true);
                    }, index * 200);
                });
            }
            
            // Camera tracking - uncomment to track a specific viewer
            // window.trackedViewer = viewer3; // Track L515 viewer (microwave_515_raw)
            
            // Initialize charts after Chart.js and depth-charts.js are loaded
            if (typeof Chart !== 'undefined' && typeof initDepthAccuracyCharts !== 'undefined') {
                initDepthAccuracyCharts();
            } else {
                // Wait for scripts to load
                const checkScripts = setInterval(() => {
                    if (typeof Chart !== 'undefined' && typeof initDepthAccuracyCharts !== 'undefined') {
                        clearInterval(checkScripts);
                        initDepthAccuracyCharts();
                    }
                }, 100);
            }
        });
        
        // ByteCamDepth Point Cloud Viewer with custom axis orientation
        class ByteCamDepthPointCloudViewer extends OptimizedPointCloudViewer {
            constructor(containerId, plyPath, isL515 = false, captureMode = false, debugMode = false) {
                // Extract scene name from plyPath BEFORE calling super
                const pathParts = plyPath.split('/');
                const filename = pathParts[pathParts.length - 1];
                const sceneName = filename.split('_')[0].toLowerCase(); // e.g., "living", "kitchen", "bedroom"
                
                // Call parent constructor - this will call init() but we'll override it
                super(containerId, plyPath, isL515, captureMode, debugMode);
                
                // Now set our properties
                this.sceneName = sceneName;
                
                // Scene-specific configurations
                this.sceneConfigs = {
                    living: {
                        cameraPosition: [-0.036, -0.313, -0.066],
                        cameraTarget: [-0.034, 0.027, -0.033],
                        pointSize: 0.002,
                        upVector: [0, 0, 1]
                    },
                    kitchen: {
                        cameraPosition: [-0.013, -0.139, -0.035],
                        cameraTarget: [-0.001, 0.002, -0.014],
                        pointSize: 0.0015,
                        upVector: [0, 0, 1]
                    },
                    bedroom: {
                        cameraPosition: [-0.016, -0.349, -0.036],
                        cameraTarget: [0.001, 0.029, -0.027],
                        pointSize: 0.004,
                        upVector: [0, 0, 1]
                    },
                    bathroom: {
                        cameraPosition: [-0.029, -0.178, -0.007],
                        cameraTarget: [-0.046, -0.021, -0.017],
                        pointSize: 0.0015,
                        upVector: [0, 0, 1]
                    },
                    office: {
                        cameraPosition: [-0.007, -0.238, -0.004],
                        cameraTarget: [0.003, -0.002, -0.041],
                        pointSize: 0.0025,
                        upVector: [0, 0, 1]
                    },
                    market: {
                        cameraPosition: [0.011, -0.183, -0.005],
                        cameraTarget: [0.010, -0.000, -0.025],
                        pointSize: 0.0025,
                        upVector: [0, 0, 1]
                    },
                    breakroom: {
                        cameraPosition: [-0.020, -0.213, 0.006],
                        cameraTarget: [-0.006, 0.000, -0.022],
                        pointSize: 0.0025,
                        upVector: [0, 0, 1]
                    }
                };
                
                // Get config for current scene or use default
                this.sceneConfig = this.sceneConfigs[this.sceneName] || this.sceneConfigs.living;
                this.pointSize = this.sceneConfig.pointSize;
                
                // Reinitialize camera position with the correct scene config
                // This is needed because init() was called before sceneConfig was set
                if (this.camera && this.controls) {
                    this.camera.position.set(
                        this.sceneConfig.cameraPosition[0],
                        this.sceneConfig.cameraPosition[1],
                        this.sceneConfig.cameraPosition[2]
                    );
                    this.camera.up.set(
                        this.sceneConfig.upVector[0],
                        this.sceneConfig.upVector[1],
                        this.sceneConfig.upVector[2]
                    );
                    this.controls.target.set(
                        this.sceneConfig.cameraTarget[0],
                        this.sceneConfig.cameraTarget[1],
                        this.sceneConfig.cameraTarget[2]
                    );
                    this.controls.update();
                }
            }
            
            // Override onGeometryLoaded to preserve original coordinates
            onGeometryLoaded(geometry) {
                const loadingDiv = this.container.querySelector('.pcd-loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }

                // For ByteCamDepth, preserve original coordinate system
                // Apply rotation to swap Y and Z axes, no centering, optional scaling
                
                // Rotate -90 degrees around X axis to swap Y and Z
                geometry.rotateX(-Math.PI / 2);
                
                // Optional: compute bounding box for info but don't center
                geometry.computeBoundingBox();
                const size = new THREE.Vector3();
                geometry.boundingBox.getSize(size);
                console.log('ByteCamDepth Point Cloud Size:', size);
                
                // Optional: scale if needed (comment out to use original scale)
                // const scale = 2 / Math.max(size.x, size.y, size.z);
                // geometry.scale(scale, scale, scale);
                
                // Create point cloud with all points
                this.currentLOD = this.createPointCloud(geometry, 1.0);
                this.scene.add(this.currentLOD);
                
                this.isLoading = false;
                
                // Capture screenshot if in capture mode
                if (this.captureMode) {
                    setTimeout(() => {
                        this.captureScreenshot();
                        setTimeout(() => {
                            this.destroy();
                        }, 100);
                    }, 500);
                }
                
                // Update debug info if in debug mode
                if (this.debugMode) {
                    this.updateDebugInfo();
                }
            }
            
            init() {
                if (!this.container) return;

                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf5f5f5);

                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    45,
                    this.container.clientWidth / this.container.clientHeight,
                    0.1,
                    1000
                );
                
                // Set camera position and orientation based on scene configuration
                // Use default config if sceneConfig isn't set yet
                const config = this.sceneConfig || {
                    cameraPosition: [0, 0, -0.515],
                    cameraTarget: [0, 0, 0],
                    pointSize: 0.002,
                    upVector: [0, 0, 1]
                };
                this.camera.position.set(config.cameraPosition[0], config.cameraPosition[1], config.cameraPosition[2]);

                // Set the up vector based on scene configuration
                this.camera.up.set(config.upVector[0], config.upVector[1], config.upVector[2]);
                
                // Optimized renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: false,
                    powerPreference: "high-performance",
                    preserveDrawingBuffer: true
                });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
                this.container.appendChild(this.renderer.domElement);

                // Controls with adjusted settings for ByteCamDepth
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = true; // Changed to true for better control
                this.controls.minDistance = 0.01; // Allow very close zoom
                this.controls.maxDistance = 5; // Allow zooming out more
                
                // Set target based on scene configuration (config is already defined above)
                this.controls.target.set(config.cameraTarget[0], config.cameraTarget[1], config.cameraTarget[2]);
                
                // Simple lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(ambientLight);
                
                // Load point cloud
                this.loadPointCloud();
                
                // Start render loop
                this.animate();
                
                // Handle resize
                window.addEventListener('resize', () => this.handleResize());
            }
            
            // Inherit loadPointCloud from parent
            loadPointCloud() {
                super.loadPointCloud();
            }
            
            // Inherit animate from parent
            animate() {
                super.animate();
            }
            
            // Inherit handleResize from parent
            handleResize() {
                super.handleResize();
            }
            
            // Implement destroy method that calls dispose
            destroy() {
                this.dispose();
            }
            
            // Override updateDebugInfo to avoid calling non-existent function
            updateDebugInfo() {
                // ByteCamDepth has its own debug info update in the main script
                // so we don't need to call updateDebugSceneInfo here
            }
            
            // Override captureScreenshot for dataset-specific naming
            captureScreenshot() {
                // Force update controls
                this.controls.update();
                
                // Ensure the scene is rendered one more time
                this.renderer.render(this.scene, this.camera);
                
                // Get the canvas
                const canvas = this.renderer.domElement;
                
                // Check if canvas has content
                if (canvas.width === 0 || canvas.height === 0) {
                    console.error('Canvas has no dimensions');
                    return null;
                }
                
                // Capture the canvas as data URL with preserveDrawingBuffer
                const dataURL = canvas.toDataURL('image/png', 1.0);
                
                // Extract camera and scene info from ply path
                // Format: pcds_dataset/camera_d435/living_depth_0.ply or living_depth_0_pred.ply
                const pathParts = this.plyPath.split('/');
                const cameraFolder = pathParts[1]; // camera_d435
                const camera = cameraFolder.replace('camera_', ''); // d435
                const filenameParts = pathParts[2].split('_'); // ['living', 'depth', '0.ply'] or ['living', 'depth', '0', 'pred.ply']
                const scene = filenameParts[0].toLowerCase(); // living
                const isPred = this.plyPath.includes('_pred.ply');
                const type = isPred ? 'pred' : 'raw';
                
                // Create filename: d435_living_raw.png or d435_living_pred.png
                const filename = `${camera}_${scene}_${type}.png`;
                
                if (this.captureMode) {
                    // Check if the image is not empty
                    if (dataURL && dataURL.length > 100) {
                        // Auto-download in capture mode
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = dataURL;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log(`Screenshot captured: ${filename} (${dataURL.length} bytes)`);
                    } else {
                        console.error(`Failed to capture screenshot for ${filename}`);
                    }
                }
                
                return dataURL;
            }
        }
        
        // ByteCamDepth Dataset Point Cloud Selector
        document.addEventListener('DOMContentLoaded', function() {
            const bytecamSceneButtons = document.querySelectorAll('#bytecam-scene-selector .selector-btn');
            const bytecamCameraButtons = document.querySelectorAll('#bytecam-camera-selector .selector-btn');
            const bytecamRawContainer = document.getElementById('bytecam-raw-container');
            const bytecamPredContainer = document.getElementById('bytecam-pred-container');
            const bytecamCdmLabel = document.getElementById('bytecam-cdm-label');
            let currentRawViewer = null;
            let currentPredViewer = null;
            
            // Check for debug mode
            const urlParams = new URLSearchParams(window.location.search);
            const debugMode = urlParams.get('debug') === 'true';
            
            // Show ByteCamDepth debug panel if in debug mode
            if (debugMode) {
                const bytecamDebugPanel = document.getElementById('bytecam-debug-panel');
                if (bytecamDebugPanel) {
                    bytecamDebugPanel.style.display = 'block';
                }
            }
            const loadBtnRaw = bytecamRawContainer.querySelector('.load-interactive-btn');
            const loadBtnPred = bytecamPredContainer.querySelector('.load-interactive-btn');
            loadBtnRaw.addEventListener('click', () => loadBytecamViewer('raw'));
            loadBtnPred.addEventListener('click', () => loadBytecamViewer('pred'));
            
            // Function to update debug info for ByteCamDepth viewers
            function updateBytecamDebugInfo() {
                if (!debugMode) return;
                
                // Update scene and camera info
                const activeScene = document.querySelector('#bytecam-scene-selector .selector-btn.active');
                const activeCamera = document.querySelector('#bytecam-camera-selector .selector-btn.active');
                
                const sceneSpan = document.getElementById('bytecam-debug-scene');
                const cameraSpan = document.getElementById('bytecam-debug-camera');
                
                if (sceneSpan && activeScene) sceneSpan.textContent = activeScene.textContent;
                if (cameraSpan && activeCamera) cameraSpan.textContent = activeCamera.textContent;
                
                // Update camera positions for raw viewer
                if (currentRawViewer && currentRawViewer.camera && currentRawViewer.controls) {
                    const rawPosSpan = document.getElementById('bytecam-debug-raw-pos');
                    const rawTargetSpan = document.getElementById('bytecam-debug-raw-target');
                    
                    if (rawPosSpan) {
                        const pos = currentRawViewer.camera.position;
                        rawPosSpan.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (rawTargetSpan) {
                        const target = currentRawViewer.controls.target;
                        rawTargetSpan.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                }
                
                // Update camera positions for pred viewer
                if (currentPredViewer && currentPredViewer.camera && currentPredViewer.controls) {
                    const predPosSpan = document.getElementById('bytecam-debug-pred-pos');
                    const predTargetSpan = document.getElementById('bytecam-debug-pred-target');
                    
                    if (predPosSpan) {
                        const pos = currentPredViewer.camera.position;
                        predPosSpan.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (predTargetSpan) {
                        const target = currentPredViewer.controls.target;
                        predTargetSpan.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                }
            }
            
            // Update debug info periodically if in debug mode
            if (debugMode) {
                setInterval(updateBytecamDebugInfo, 100);
            }
            
            function loadBytecamViewer(type) {
                const container = type === 'raw' ? bytecamRawContainer : bytecamPredContainer;
                const viewerId = type === 'raw' ? 'bytecam-raw-viewer' : 'bytecam-pred-viewer';
                const plyPath = container.getAttribute('data-ply-path');
                const isL515 = container.getAttribute('data-is-l515') === 'true';
                const loadBtn = container.querySelector('.load-interactive-btn');
                const viewerDiv = document.getElementById(viewerId);
                
                // Clean up existing viewer first (before modifying DOM)
                if (type === 'raw' && currentRawViewer) {
                    try {
                        if (currentRawViewer.destroy) {
                            currentRawViewer.destroy();
                        }
                    } catch (e) {
                        console.error('Error destroying raw viewer:', e);
                    }
                    currentRawViewer = null;
                } else if (type === 'pred' && currentPredViewer) {
                    try {
                        if (currentPredViewer.destroy) {
                            currentPredViewer.destroy();
                        }
                    } catch (e) {
                        console.error('Error destroying pred viewer:', e);
                    }
                    currentPredViewer = null;
                }
                
                // Hide placeholder and button, show viewer div
                const placeholder = container.querySelector('.pcd-placeholder');
                if (placeholder) placeholder.style.display = 'none';
                if (loadBtn) loadBtn.style.display = 'none';
                if (viewerDiv) {
                    // Clear and reset the viewer div
                    viewerDiv.innerHTML = '';
                    viewerDiv.innerHTML = '<div class="pcd-loading">Initializing viewer...</div>';
                    viewerDiv.style.display = 'block';
                }
                
                // Create new viewer after a small delay to ensure cleanup
                setTimeout(() => {
                    try {
                        if (type === 'raw') {
                            currentRawViewer = new ByteCamDepthPointCloudViewer(viewerId, plyPath, isL515, false, debugMode);
                        } else {
                            currentPredViewer = new ByteCamDepthPointCloudViewer(viewerId, plyPath, isL515, false, debugMode);
                        }
                    } catch (e) {
                        console.error('Error creating viewer:', e);
                        if (viewerDiv) {
                            viewerDiv.innerHTML = '<div class="pcd-loading">Error loading viewer. Please try again.</div>';
                        }
                    }
                }, 200); // Increased delay slightly
            }
            
            function updateBytecamPointClouds() {
                // Get selected scene and camera
                const activeScene = document.querySelector('#bytecam-scene-selector .selector-btn.active');
                const activeCamera = document.querySelector('#bytecam-camera-selector .selector-btn.active');
                
                if (!activeScene || !activeCamera) return;
                
                const scene = activeScene.dataset.scene;
                const camera = activeCamera.dataset.camera;
                
                // Handle special cases - file names don't match exactly
                let fileName;
                if (scene === 'breakroom') {
                    fileName = 'BreakRoom';
                } else {
                    fileName = scene;
                }
                
                // Build file paths
                const rawPath = `pcds_dataset/camera_${camera}/${fileName}_depth_0.ply`;
                const predPath = `pcds_dataset/camera_${camera}/${fileName}_depth_0_pred.ply`;
                
                // Update RGB image
                const rgbImagePath = `pcds_dataset/camera_${camera}/${fileName}_rgb_0.png`;
                const rgbImage = document.getElementById('bytecam-rgb-image');
                if (rgbImage) {
                    rgbImage.src = rgbImagePath;
                }
                
                // Update raw container
                bytecamRawContainer.setAttribute('data-ply-path', rawPath);
                bytecamRawContainer.setAttribute('data-is-l515', 'false');
                
                // Update pred container
                bytecamPredContainer.setAttribute('data-ply-path', predPath);
                bytecamPredContainer.setAttribute('data-is-l515', 'false');
                
                // Update CDM label
                const cameraName = activeCamera.textContent;
                bytecamCdmLabel.textContent = `CDM-${cameraName} Point Cloud`;
                
                // Clean up existing viewers
                if (currentRawViewer) {
                    if (currentRawViewer.destroy) {
                        currentRawViewer.destroy();
                    }
                    currentRawViewer = null;
                }
                if (currentPredViewer) {
                    if (currentPredViewer.destroy) {
                        currentPredViewer.destroy();
                    }
                    currentPredViewer = null;
                }
                
                // Reset both viewers
                const rawViewerDiv = document.getElementById('bytecam-raw-viewer');
                const predViewerDiv = document.getElementById('bytecam-pred-viewer');
                const rawPlaceholder = bytecamRawContainer.querySelector('.pcd-placeholder');
                const predPlaceholder = bytecamPredContainer.querySelector('.pcd-placeholder');
                const rawLoadBtn = bytecamRawContainer.querySelector('.load-interactive-btn');
                const predLoadBtn = bytecamPredContainer.querySelector('.load-interactive-btn');
                
                // Update placeholder images
                if (rawPlaceholder) {
                    rawPlaceholder.src = `screenshots_dataset/${camera}_${fileName.toLowerCase()}_raw.png`;
                    rawPlaceholder.style.display = 'block';
                }
                if (predPlaceholder) {
                    predPlaceholder.src = `screenshots_dataset/${camera}_${fileName.toLowerCase()}_pred.png`;
                    predPlaceholder.style.display = 'block';
                }
                
                if (rawViewerDiv) {
                    rawViewerDiv.innerHTML = '<div class="pcd-loading">Initializing viewer...</div>';
                    rawViewerDiv.style.display = 'none';
                }
                if (predViewerDiv) {
                    predViewerDiv.innerHTML = '<div class="pcd-loading">Initializing viewer...</div>';
                    predViewerDiv.style.display = 'none';
                }
                
                if (rawLoadBtn) {
                    rawLoadBtn.style.display = 'block';
                    rawLoadBtn.textContent = 'Interactive View';
                    // Remove old event listeners and add new one
                    const newRawBtn = rawLoadBtn.cloneNode(true);
                    rawLoadBtn.parentNode.replaceChild(newRawBtn, rawLoadBtn);
                    newRawBtn.addEventListener('click', () => loadBytecamViewer('raw'));
                }
                
                if (predLoadBtn) {
                    predLoadBtn.style.display = 'block';
                    predLoadBtn.textContent = 'Interactive View';
                    // Remove old event listeners and add new one
                    const newPredBtn = predLoadBtn.cloneNode(true);
                    predLoadBtn.parentNode.replaceChild(newPredBtn, predLoadBtn);
                    newPredBtn.addEventListener('click', () => loadBytecamViewer('pred'));
                }
            }
            
            // Initialize the point cloud data and RGB image for default selection
            updateBytecamPointClouds();
            
            // Scene selector event handlers
            bytecamSceneButtons.forEach(button => {
                button.addEventListener('click', function() {
                    bytecamSceneButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    updateBytecamPointClouds();
                });
            });
            
            // Camera selector event handlers
            bytecamCameraButtons.forEach(button => {
                button.addEventListener('click', function() {
                    bytecamCameraButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    updateBytecamPointClouds();
                });
            });
            
            // Initial setup for load buttons
            const initialRawBtn = bytecamRawContainer.querySelector('.load-interactive-btn');
            const initialPredBtn = bytecamPredContainer.querySelector('.load-interactive-btn');
            
            if (initialRawBtn) {
                initialRawBtn.addEventListener('click', () => loadBytecamViewer('raw'));
            }
            if (initialPredBtn) {
                initialPredBtn.addEventListener('click', () => loadBytecamViewer('pred'));
            }
            
            // Capture dataset screenshots if in capture_dataset mode
            const captureDatasetMode = new URLSearchParams(window.location.search).get('capture_dataset') === 'true';
            if (captureDatasetMode) {
                console.log('Starting ByteCamDepth dataset screenshot capture...');
                captureAllDatasetScreenshots();
            }
            
            async function captureAllDatasetScreenshots() {
                const scenes = ['living', 'kitchen', 'bedroom', 'bathroom', 'office', 'market', 'breakroom'];
                const cameras = ['d405', 'd435', 'l515', 'kinect', 'zed2i_neural', 'zed2i_quality'];
                
                // Hide the placeholder images and buttons to prepare for capture
                const rawContainer = document.getElementById('bytecam-raw-container');
                const predContainer = document.getElementById('bytecam-pred-container');
                
                for (const camera of cameras) {
                    for (const scene of scenes) {
                        console.log(`Capturing ${camera}_${scene}...`);
                        
                        // Update scene and camera selection
                        const sceneBtn = document.querySelector(`#bytecam-scene-selector button[data-scene="${scene}"]`);
                        const cameraBtn = document.querySelector(`#bytecam-camera-selector button[data-camera="${camera}"]`);
                        
                        if (sceneBtn && cameraBtn) {
                            // Trigger click events to update selection
                            sceneBtn.click();
                            cameraBtn.click();
                            
                            // Wait for DOM update
                            await new Promise(resolve => setTimeout(resolve, 500));
                            
                            // Make sure viewers are visible and properly sized
                            const rawViewerDiv = document.getElementById('bytecam-raw-viewer');
                            const predViewerDiv = document.getElementById('bytecam-pred-viewer');
                            
                            // Show and size the viewer divs
                            if (rawViewerDiv) {
                                rawViewerDiv.style.display = 'block';
                                rawViewerDiv.style.width = '600px';
                                rawViewerDiv.style.height = '400px';
                                rawViewerDiv.innerHTML = '';
                            }
                            if (predViewerDiv) {
                                predViewerDiv.style.display = 'block';
                                predViewerDiv.style.width = '600px';
                                predViewerDiv.style.height = '400px';
                                predViewerDiv.innerHTML = '';
                            }
                            
                            // Capture raw point cloud
                            const rawPath = `pcds_dataset/camera_${camera}/${scene === 'breakroom' ? 'BreakRoom' : scene}_depth_0.ply`;
                            console.log(`Loading raw: ${rawPath}`);
                            const rawViewer = new ByteCamDepthPointCloudViewer('bytecam-raw-viewer', rawPath, camera === 'l515', true, false);
                            
                            // Wait for raw capture to complete
                            await new Promise(resolve => setTimeout(resolve, 3000));
                            
                            // Capture predicted point cloud
                            const predPath = `pcds_dataset/camera_${camera}/${scene === 'breakroom' ? 'BreakRoom' : scene}_depth_0_pred.ply`;
                            console.log(`Loading pred: ${predPath}`);
                            const predViewer = new ByteCamDepthPointCloudViewer('bytecam-pred-viewer', predPath, camera === 'l515', true, false);
                            
                            // Wait for pred capture to complete
                            await new Promise(resolve => setTimeout(resolve, 3000));
                        }
                    }
                }
                
                console.log('Dataset screenshot capture complete!');
                alert('Screenshot capture complete! Check your downloads folder.');
            }
        });
        
        // Video autoplay with Intersection Observer
        document.addEventListener('DOMContentLoaded', function() {
            const videos = document.querySelectorAll('.demo-video');
            
            const videoObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    const video = entry.target;
                    
                    if (entry.isIntersecting) {
                        // Play video when it comes into view
                        video.play().catch(err => {
                            console.log('Video autoplay was blocked:', err);
                        });
                    } else {
                        // Pause video when it goes out of view
                        video.pause();
                    }
                });
            }, {
                threshold: 0.5 // Video needs to be 50% visible to start playing
            });
            
            // Observe all demo videos
            videos.forEach(video => {
                videoObserver.observe(video);
            });
            
            // Video synchronization for paired videos
            const syncVideos = document.querySelectorAll('.sync-video');
            
            syncVideos.forEach(video => {
                // Sync play/pause events
                video.addEventListener('play', function() {
                    const group = this.dataset.syncGroup;
                    const pairedVideos = document.querySelectorAll(`[data-sync-group="${group}"]`);
                    
                    pairedVideos.forEach(pairedVideo => {
                        if (pairedVideo !== this && pairedVideo.paused) {
                            pairedVideo.currentTime = this.currentTime;
                            pairedVideo.play();
                        }
                    });
                });
                
                video.addEventListener('pause', function() {
                    const group = this.dataset.syncGroup;
                    const pairedVideos = document.querySelectorAll(`[data-sync-group="${group}"]`);
                    
                    pairedVideos.forEach(pairedVideo => {
                        if (pairedVideo !== this && !pairedVideo.paused) {
                            pairedVideo.pause();
                        }
                    });
                });
                
                // Sync seeking
                video.addEventListener('seeking', function() {
                    const group = this.dataset.syncGroup;
                    const pairedVideos = document.querySelectorAll(`[data-sync-group="${group}"]`);
                    
                    pairedVideos.forEach(pairedVideo => {
                        if (pairedVideo !== this) {
                            pairedVideo.currentTime = this.currentTime;
                        }
                    });
                });
            });
        });

        // Video comparison BeforeAfter class
        class VideoBeforeAfter {
            constructor(config) {
                const container = document.querySelector(config.id);
                if (!container) return;
                
                const before = container.querySelector('.bal-before');
                const beforeInset = container.querySelector('.bal-before-inset');
                const beforeVideo = container.querySelector('.bal-before-video');
                const afterVideo = container.querySelector('.bal-after-video');
                const handle = container.querySelector('.bal-handle');
                
                // Initialize video sync
                this.syncVideos(beforeVideo, afterVideo);
                
                // Set initial width for before-inset to match container
                beforeInset.style.width = container.offsetWidth + 'px';
                
                // Update on window resize
                window.addEventListener('resize', () => {
                    beforeInset.style.width = container.offsetWidth + 'px';
                });
                
                // Set initial position
                before.style.width = '50%';
                handle.style.left = '50%';
                
                // Mouse move event - slider follows mouse directly
                container.addEventListener('mousemove', (e) => {
                    const containerWidth = container.offsetWidth;
                    const rect = container.getBoundingClientRect();
                    const offsetX = e.clientX - rect.left;
                    const percentage = (offsetX / containerWidth) * 100;
                    
                    if (percentage > 2 && percentage < 98) {
                        before.style.width = percentage + '%';
                        handle.style.left = percentage + '%';
                    }
                });
                
                // Touch events for mobile
                container.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const containerWidth = container.offsetWidth;
                    const rect = container.getBoundingClientRect();
                    const offsetX = e.touches[0].clientX - rect.left;
                    const percentage = (offsetX / containerWidth) * 100;
                    
                    if (percentage > 2 && percentage < 98) {
                        before.style.width = percentage + '%';
                        handle.style.left = percentage + '%';
                    }
                });
            }
            
            syncVideos(video1, video2) {
                if (!video1 || !video2) return;
                
                // Function to sync the videos
                const sync = () => {
                    if (Math.abs(video1.currentTime - video2.currentTime) > 0.1) {
                        video1.currentTime = video2.currentTime;
                    }
                };
                
                // Sync events from after (bottom) video to before (top) video
                video2.addEventListener('play', () => video1.play());
                video2.addEventListener('pause', () => video1.pause());
                video2.addEventListener('seeked', sync);
                video2.addEventListener('timeupdate', sync);
                
                // Start both videos
                Promise.all([
                    video1.play().catch(e => console.log('Video 1 autoplay failed')),
                    video2.play().catch(e => console.log('Video 2 autoplay failed'))
                ]);
            }
        }
        
        // BeforeAfter class for slider functionality
        class BeforeAfter {
            constructor(enteryObject) {
                const beforeAfterContainer = document.querySelector(enteryObject.id);
                const before = beforeAfterContainer.querySelector('.bal-before');
                const beforeText = beforeAfterContainer.querySelector('.bal-beforePosition');
                const afterText = beforeAfterContainer.querySelector('.bal-afterPosition');
                const handle = beforeAfterContainer.querySelector('.bal-handle');
                let widthChange = 0;

                // Set width on before-inset to match container width
                const beforeInset = beforeAfterContainer.querySelector('.bal-before-inset');
                if (beforeInset) {
                    beforeInset.style.width = beforeAfterContainer.offsetWidth + "px";
                    window.addEventListener('resize', function () {
                        beforeInset.style.width = beforeAfterContainer.offsetWidth + "px";
                    });
                }
                before.setAttribute('style', "width: 50%;");
                handle.setAttribute('style', "left: 50%;");

                // Update handle position
                function updateHandlePosition(newWidth) {
                    handle.style.left = `${newWidth}%`;
                }

                //touch screen event listener
                beforeAfterContainer.addEventListener("touchstart", (e) => {
                    beforeAfterContainer.addEventListener("touchmove", (e2) => {
                        let containerWidth = beforeAfterContainer.offsetWidth;
                        const rect = beforeAfterContainer.getBoundingClientRect();
                        let currentPoint = e2.changedTouches[0].clientX;
                        let offsetX = currentPoint - rect.left;

                        if (offsetX > 10 && offsetX < containerWidth - 10) {
                            let newWidth = offsetX * 100 / containerWidth;
                            before.style.width = newWidth + "%";
                            handle.style.left = newWidth + "%";
                        }
                    });
                });

                //mouse move event listener
                beforeAfterContainer.addEventListener('mousemove', (e) => {
                    let containerWidth = beforeAfterContainer.offsetWidth;
                    const rect = beforeAfterContainer.getBoundingClientRect();
                    const offsetX = e.clientX - rect.left;
                    let newWidth = offsetX * 100 / containerWidth;

                    if (offsetX > 10 && offsetX < containerWidth - 10) {
                        before.style.width = newWidth + "%";
                        handle.style.left = newWidth + "%";
                    }
                });
            }
        }
        
        // Initialize the before/after slider
        new BeforeAfter({
            id: '#kitchen-comparison'
        });
        new BeforeAfter({
            id: '#canteen-comparison'
        });
    </script>
</body>
</html>
