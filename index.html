<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manipulation as in Simulation: Enabling Accurate Geometry Perception in Robots</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Optimized Three.js for point cloud visualization -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/PLYLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    
    <!-- Chart.js for lightweight, fast interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/depth-charts.js" defer></script>
</head>
<body>
    <header>
        <div class="logo-container">
            <a href="https://seed.bytedance.com/en/" target="_blank" class="logo-link">
                <img src="seed/seed_logo.png" alt="ByteDance Seed" class="bytedance-seed-logo">
            </a>
        </div>
        <div class="container">
            <div class="header-content">
                <h1 class="title">Manipulation as in Simulation:<br>Enabling Accurate Geometry Perception in Robots</h1>
            
            <div class="authors">
                <div class="author-row">
                    <span class="author"><a href="https://minghuanliu.com" target="_blank">Minghuan Liu</a><sup>1,*,†</sup></span>
                    <span class="author"><a href="https://zbzhu99.github.io/" target="_blank">Zhengbang Zhu</a><sup>1,2,*</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=Mo8I5WMAAAAJ/" target="_blank">Xiaoshen Han</a><sup>1,2,*</sup></span>
                    <span class="author">Peng Hu<sup>1,*</sup></span>
                    <span class="author"><a href="https://haotongl.github.io/" target="_blank">Haotong Lin</a><sup>1,3</sup></span>
                    <span class="author">Xinyao Li<sup>2</sup></span>
                </div>
                <div class="author-row">
                    <span class="author"><a href="https://timerchen.github.io/" target="_blank">Jingxiao Chen</a><sup>1,2</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=GPmUxtIAAAAJ" target="_blank">Jiafeng Xu</a><sup>1</sup></span>
                    <span class="author"><a href="https://yangyichu.github.io/" target="_blank">Yichu Yang</a><sup>1</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=0ar3JNYAAAAJ" target="_blank">Yunfeng Lin</a><sup>2</sup></span>
                    <span class="author"><a href="https://scholar.google.com/citations?user=laOWyTQAAAAJ" target="_blank">Xinghang Li</a><sup>4</sup></span>
                </div>
                <div class="author-row">
                    <span class="author"><a href="https://scholar.google.com/citations?user=-84M1m0AAAAJ" target="_blank">Yong Yu</a><sup>2</sup></span>
                    <span class="author"><a href="http://wnzhang.net/" target="_blank">Weinan Zhang</a><sup>2</sup></span>
                    <span class="author"><a href="https://www.taokong.org/" target="_blank">Tao Kong</a><sup>1</sup></span>
                    <span class="author"><a href="https://bingykang.github.io/" target="_blank">Bingyi Kang</a><sup>1,†</sup></span>
                </div>
            </div>
            
            <div class="affiliations">
                <div class="affiliation"><sup>1</sup>ByteDance Seed</div>
                <div class="affiliation"><sup>2</sup>Shanghai Jiao Tong University</div>
                <div class="affiliation"><sup>3</sup>Zhejiang University</div>
                <div class="affiliation"><sup>4</sup>Tsinghua University</div>
            </div>
            
            <div class="notes">
                <p><sup>*</sup>Equal Contribution &nbsp;&nbsp; <sup>†</sup>Corresponding Authors</p>
                <p>Minghuan did this work when he was at ByteDance Seed.</p>
            </div>
            
            <div class="contributions-compact">
                <a href="#dataset" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">📊</div>
                        <div class="contribution-text">
                            <h4>ByteDepth Dataset</h4>
                            <p>170K+ RGB-depth pairs from 7 cameras</p>
                        </div>
                    </div>
                </a>
                <a href="#models" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">🔧</div>
                        <div class="contribution-text">
                            <h4>Camera Depth Models</h4>
                            <p>Plug-in solution for accurate depth perception</p>
                        </div>
                    </div>
                </a>
                <a href="#setup" class="contribution-link">
                    <div class="contribution-compact">
                        <div class="contribution-icon">🚀</div>
                        <div class="contribution-text">
                            <h4>Sim-to-Real Transfer</h4>
                            <p>First depth-only policy with seamless transfer</p>
                        </div>
                    </div>
                </a>
            </div>
            
            <div class="links">
                <a href="#" class="btn"><i class="fas fa-file-pdf"></i> Paper</a>
                <a href="https://github.com/manipulation-as-in-simulation" class="btn"><i class="fab fa-github"></i> Code</a>
                <a href="#dataset" class="btn"><i class="fas fa-database"></i> Dataset</a>
                <a href="#models" class="btn"><i class="fas fa-cube"></i> Models</a>
            </div>
            </div>
        </div>
    </header>

    <section id="models" class="models">
        <div class="container">
            <h2>Available Camera Depth Models</h2>
            <p>We release camera depth models for various widely-used depth cameras:</p>
            
            <div class="model-grid">
                <div class="model-card">
                    <h3>CDM-435</h3>
                    <p>For RealSense D435 camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card">
                    <h3>CDM-L515</h3>
                    <p>For RealSense L515 camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card">
                    <h3>CDM-Kinect</h3>
                    <p>For Azure Kinect camera</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card">
                    <h3>CDM-Zed2i Neural</h3>
                    <p>For Zed2i camera, Neural mode</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
                <div class="model-card">
                    <h3>CDM-Zed2i Performance</h3>
                    <p>For Zed2i camera, Performance mode</p>
                    <a href="#" class="btn-download"><i class="fas fa-download"></i> Download</a>
                </div>
            </div>
        </div>
    </section>

    <section class="video">
        <div class="container">
            <h2>Video Overview</h2>
            <div class="video-container">
                <iframe width="100%" height="500" src="https://www.youtube.com/embed/VIDEO_ID" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </section>

    <section class="abstract">
        <div class="container">
            <h2>Abstract</h2>
            <img src="figs/teaser.png" alt="Teaser Figure" class="teaser-image">
            <p>
                Modern robotic manipulation primarily relies on visual observations in a 2D color space for skill learning, but suffers from poor generalization. In contrast, humans, living in a 3D world, depend more on physical properties—such as distance, size, and shape—than on texture when interacting with objects. Since such 3D geometric information can be acquired from widely available depth cameras, it appears feasible to endow robots with similar perceptual capabilities. Our pilot study found that using depth cameras for manipulation is challenging, primarily due to their limited accuracy and susceptibility to various types of noise. In this work, we propose <strong>Camera Depth Models (CDMs)</strong> as a simple plugin on daily-use depth cameras, which take RGB images and raw depth signals as input and output denoised, accurate metric depth. To achieve this, we develop a neural data engine that generates high-quality paired data from simulation by modeling a depth camera's noise pattern. Our results show that CDMs achieve nearly simulation-level accuracy in depth prediction, effectively bridging the sim-to-real gap for manipulation tasks. Notably, our experiments demonstrate, <strong>for the first time</strong>, that a depth-only policy trained exclusively in simulation generalizes seamlessly to real robots on two long-horizon tasks, with little to no performance degradation. Further analysis reveals that sim-to-real success rates are strongly correlated with the quality of depth perception. We hope our findings will inspire future research in utilizing simulation data and 3D information in general robot policies.
            </p>
        </div>
    </section>

    <section id="dataset" class="dataset">
        <div class="container">
            <h2>ByteDepth Dataset</h2>
            <p>We introduce ByteDepth, a real-world multi-camera depth dataset comprising over <strong>170,000 RGB-depth pairs</strong> from ten distinct configurations captured by seven depth cameras.</p>
            <p>
            <div class="dataset-stats">
                <div class="stat-item">
                    <h3>170K+</h3>
                    <p>RGB-Depth Pairs</p>
                </div>
                <div class="stat-item">
                    <h3>7</h3>
                    <p>Depth Cameras</p>
                </div>
                <div class="stat-item">
                    <h3>10</h3>
                    <p>Configurations</p>
                </div>
            </div>
            
            <!-- Dataset Image Selector -->
            <div class="dataset-selector-container">
                <div class="selector-group">
                    <span class="selector-label">Camera:</span>
                    <div class="selector-buttons" id="camera-dataset-selector">
                        <button class="selector-btn active" data-camera="d435">D435</button>
                        <button class="selector-btn" data-camera="d415">D415</button>
                        <button class="selector-btn" data-camera="d455">D455</button>
                        <button class="selector-btn" data-camera="d405">D405</button>
                        <button class="selector-btn" data-camera="l515">L515</button>
                        <button class="selector-btn" data-camera="kinect">Kinect</button>
                        <button class="selector-btn" data-camera="zed2i_neural">ZED2i-N.</button>
                        <button class="selector-btn" data-camera="zed2i_ultra">ZED2i-U.</button>
                        <button class="selector-btn" data-camera="zed2i_quality">ZED2i-Q.</button>
                        <button class="selector-btn" data-camera="zed2i_performance">ZED2i-P.</button>
                    </div>
                </div>
                <div class="selector-group">
                    <span class="selector-label">Scene:</span>
                    <div class="selector-buttons" id="scene-dataset-selector">
                        <button class="selector-btn active" data-scene="living">Living Room</button>
                        <button class="selector-btn" data-scene="kichen">Kitchen</button>
                        <button class="selector-btn" data-scene="bedroom">Bedroom</button>
                        <button class="selector-btn" data-scene="bathroom">Bathroom</button>
                        <button class="selector-btn" data-scene="office">Office</button>
                        <button class="selector-btn" data-scene="market">Market</button>
                        <button class="selector-btn" data-scene="break_room">Break Room</button>
                    </div>
                </div>
            </div>
            
            <div class="dataset-images" id="dataset-images-container">
                <div class="rgb-depth-pair">
                    <div class="rgb-depth-item">
                        <img id="dataset-rgb-image" src="figs/rgb_depth/camera_d435/living_rgb.png" alt="RGB Image">
                        <p>RGB Image</p>
                    </div>
                    <div class="rgb-depth-item">
                        <img id="dataset-depth-image" src="figs/rgb_depth/camera_d435/living_depth.png" alt="Depth Image">
                        <p>Depth Image</p>
                    </div>
                </div>
            </div>
            
            <div class="dataset-download">
                <a href="#" class="btn-dataset-download">
                    <i class="fas fa-download"></i>
                    <span class="download-text">
                        <strong>Download ByteDepth Dataset</strong>
                        <small>170K+ RGB-Depth Pairs | Multi-Camera | 10 Configurations</small>
                    </span>
                    <i class="fas fa-arrow-right arrow-icon"></i>
                </a>
            </div>
        </div>
    </section>

    <section class="results">
        <div class="container">
            <h2>Key Results</h2>
            
            <div class="result-section">
                <h3>Depth Quality Comparison</h3>
                <div class="comparison-full">
                    <h4>Kitchen Scene</h4>
                    <div class="image-row-6">
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-435 Output</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/microwave_515/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-L515 Output</p>
                        </div>
                    </div>
                    
                    <h4>Canteen Scene</h4>
                    <div class="image-row-6">
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (D435)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_435/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-435 Output</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_rgb_frame10.png" alt="RGB">
                            <p>RGB Image (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_depth_frame10.png" alt="Raw Depth">
                            <p>Raw Depth (L515)</p>
                        </div>
                        <div class="image-item">
                            <img src="figs/compare_depths/canteen_515/output_ep000_camera_0_model_depth_frame10.png" alt="CDM Depth">
                            <p>CDM-L515 Output</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-section">
                <h3>Point Cloud Quality Comparison</h3>
                <p style="text-align: center; margin-bottom: 20px; color: #666;">Interactive 3D visualization - Use mouse to rotate, scroll to zoom</p>
                
                <!-- Scene and Camera Selection Buttons -->
                <div class="pcd-selector-container">
                    <div class="selector-group">
                        <span class="selector-label">Scene:</span>
                        <div class="selector-buttons" id="scene-selector">
                            <button class="selector-btn active" data-scene="kitchen">Kitchen</button>
                            <button class="selector-btn" data-scene="canteen">Canteen</button>
                            <button class="selector-btn" data-scene="stackbowl">Stack Bowl</button>
                            <button class="selector-btn" data-scene="toothpaste">Place Toothpaste</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Camera:</span>
                        <div class="selector-buttons" id="camera-selector">
                            <button class="selector-btn active" data-camera="435">D435</button>
                            <button class="selector-btn" data-camera="515">L515</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Model A:</span>
                        <div class="selector-buttons" id="model-a-selector">
                            <button class="selector-btn active" data-model="435">CDM-D435</button>
                            <button class="selector-btn" data-model="515">CDM-L515</button>
                            <button class="selector-btn" data-model="priorda">PriorDA</button>
                        </div>
                    </div>
                    <div class="selector-group">
                        <span class="selector-label">Model B:</span>
                        <div class="selector-buttons" id="model-b-selector">
                            <button class="selector-btn" data-model="435">CDM-D435</button>
                            <button class="selector-btn active" data-model="515">CDM-L515</button>
                            <button class="selector-btn" data-model="priorda">PriorDA</button>
                        </div>
                    </div>
                </div>
                
                <!-- Debug Info Panel (only visible in debug mode) -->
                <div id="debug-panel" class="debug-panel" style="display: none;">
                    <h4>Camera View Parameters (Debug Mode)</h4>
                    <div class="debug-content">
                        <div class="debug-viewer-info">
                            <h5>Left Viewer (Raw Depth)</h5>
                            <div class="debug-params">
                                <div>Position: <span id="debug-left-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="debug-left-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-viewer-info">
                            <h5>Right Viewer (CDM Output)</h5>
                            <div class="debug-params">
                                <div>Position: <span id="debug-right-pos">(0, 0, 0)</span></div>
                                <div>Target: <span id="debug-right-target">(0, 0, 0)</span></div>
                            </div>
                        </div>
                        <div class="debug-scene-info">
                            <small>Scene: <span id="debug-scene">-</span> | Camera: <span id="debug-camera">-</span></small>
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Point Cloud Display Area -->
                <div id="pcd-dynamic-display">
                    <!-- Kitchen D435 (default view) -->
                    <div class="pcd-scene-camera-group" data-scene="kitchen" data-camera="435">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Kitchen Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-kitchen-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-raw" data-ply-path="pcds/microwave_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="kitchen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-model-a" data-ply-path="pcds/microwave_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="kitchen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-435-model-b" data-ply-path="pcds/microwave_435_model_515_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/microwave_435_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Kitchen L515 -->
                    <div class="pcd-scene-camera-group" data-scene="kitchen" data-camera="515" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Kitchen Scene - L515 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-kitchen-515">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-raw" data-ply-path="pcds/microwave_515_raw_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="kitchen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-model-a" data-ply-path="pcds/microwave_515_model_435_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="kitchen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-microwave-515-model-b" data-ply-path="pcds/microwave_515_model_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/microwave_515_model_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-microwave-515-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canteen D435 -->
                    <div class="pcd-scene-camera-group" data-scene="canteen" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Canteen Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-canteen-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-raw" data-ply-path="pcds/canteen_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="canteen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-model-a" data-ply-path="pcds/canteen_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="canteen" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-435-model-b" data-ply-path="pcds/canteen_435_model_515_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/canteen_435_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canteen L515 -->
                    <div class="pcd-scene-camera-group" data-scene="canteen" data-camera="515" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Canteen Scene - L515 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-canteen-515">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-raw" data-ply-path="pcds/canteen_515_raw_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="canteen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-model-a" data-ply-path="pcds/canteen_515_model_435_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="canteen" data-camera="515">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-canteen-515-model-b" data-ply-path="pcds/canteen_515_model_515_depth.ply" data-is-l515="true">
                                    <img class="pcd-placeholder" src="screenshots/canteen_515_model_515_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-canteen-515-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-L515</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stack Bowl D435 -->
                    <div class="pcd-scene-camera-group" data-scene="stackbowl" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Stack Bowl Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-stackbowl-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-raw" data-ply-path="pcds/stackbowl_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="stackbowl" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-model-a" data-ply-path="pcds/stackbowl_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="stackbowl" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-stackbowl-435-model-b" data-ply-path="pcds/stackbowl_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/stackbowl_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-stackbowl-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-D435</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Place Toothpaste D435 -->
                    <div class="pcd-scene-camera-group" data-scene="toothpaste" data-camera="435" style="display: none;">
                        <h4 style="font-size: 1.2rem; margin: 30px 0 20px 0; color: #666; text-align: center;">Place Toothpaste Scene - D435 Camera</h4>
                        <div class="pcd-grid" id="pcd-grid-toothpaste-435">
                            <div class="pcd-item">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-raw" data-ply-path="pcds/toothpaste_435_raw_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_raw_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-raw" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Raw Depth Point Cloud</p>
                            </div>
                            <div class="pcd-item model-a-viewer" data-scene="toothpaste" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-model-a" data-ply-path="pcds/toothpaste_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-model-a" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model A: CDM-D435</p>
                            </div>
                            <div class="pcd-item model-b-viewer" data-scene="toothpaste" data-camera="435">
                                <div class="pcd-lazy-container" data-viewer-id="pcd-viewer-toothpaste-435-model-b" data-ply-path="pcds/toothpaste_435_model_435_depth.ply" data-is-l515="false">
                                    <img class="pcd-placeholder" src="screenshots/toothpaste_435_model_435_depth.png" alt="Loading...">
                                    <button class="load-interactive-btn">Interactive View</button>
                                    <div id="pcd-viewer-toothpaste-435-model-b" class="pcd-viewer-optimized" style="display: none;">
                                        <div class="pcd-loading">Initializing viewer...</div>
                                    </div>
                                </div>
                                <p>Model B: CDM-D435</p>
                            </div>
                        </div>
                    </div>
                    
                </div> <!-- End of pcd-dynamic-display -->
            </div>
        </div>
    </section>

    <section class="depth-accuracy">
        <div class="container">
            <h2>Depth Accuracy w.r.t Distance</h2>
            <p>To understand the working range of CDMs and help users effectively use them, we evaluated the depth accuracy of CDMs at various distances on the Hammer dataset. The results show that CDMs achieve high accuracy across different distances, with performance trends following the original camera capabilities while significantly reducing noise and errors.</p>
            
            <!-- Dataset Selector Buttons -->
            <div class="accuracy-selector-container">
                <div class="selector-group">
                    <span class="selector-label">Dataset:</span>
                    <div class="selector-buttons" id="dataset-selector">
                        <button class="selector-btn active" data-dataset="d435">D435</button>
                        <button class="selector-btn" data-dataset="l515">L515</button>
                        <button class="selector-btn" data-dataset="helios">Helios</button>
                    </div>
                </div>
            </div>
            
            <div id="accuracy-charts-container">
                <!-- D435 Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="d435">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">D435 Dataset - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="d435-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">D435 Dataset - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="d435-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- L515 Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="l515" style="display: none;">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">L515 Dataset - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="l515-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">L515 Dataset - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="l515-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Helios Dataset Charts -->
                <div class="accuracy-dataset-group" data-dataset="helios" style="display: none;">
                    <div class="accuracy-charts">
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">Helios Dataset - Absolute Relative Error</h4>
                            <div class="chart-container">
                                <canvas id="helios-absrel-chart"></canvas>
                            </div>
                        </div>
                        <div class="chart-item">
                            <h4 style="text-align: center; color: #555; margin-bottom: 10px; font-size: 0.95rem;">Helios Dataset - L1 Error</h4>
                            <div class="chart-container">
                                <canvas id="helios-l1-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="accuracy-insights">
                <h3>Observations</h3>
                <ul></ul>
                    <li>Raw depth shows larger errors than manufacturer specifications (may be dataset bias)</li>
                    <li>CDMs maintain high accuracy within the camera's optimal working range</li>
                    <li>Performance trends follow the original camera capabilities while significantly reducing noise</li>
                </ul>
            </div>
        </div>
    </section>

    <section class="setup" id="setup">
        <div class="container">
            <h2>UR5 Manipulation Experiment Setup</h2>
            <p class="setup-description">Experimental setup for simulation and real-world experiments with two different cameras (D435 and L515) for kitchen and canteen tasks.</p>
            
            <div class="setup-row">
                <div class="setup-item-exp">
                    <img src="figs/ur5-setup-sim.png" alt="Overall setup (sim)">
                    <h4>Overall Setup (Simulation)</h4>
                    <p>Simulation environment with camera pose randomization for demonstration generation</p>
                </div>
                <div class="setup-item-exp">
                    <img src="figs/sim-range-microwave.png" alt="Kitchen task randomization (sim)">
                    <h4>Kitchen Task Randomization (Sim)</h4>
                    <p>Training environment with randomization for bowl and microwave positions</p>
                </div>
                <div class="setup-item-exp">
                    <img src="figs/sim-range-plate.png" alt="Canteen task randomization (sim)">
                    <h4>Canteen Task Randomization (Sim)</h4>
                    <p>Simulation environment with randomization for plate and box positions</p>
                </div>
            </div>
            
            <div class="setup-row">
                <div class="setup-item-exp">
                    <img src="figs/ur5-setup.png" alt="Overall setup (real)">
                    <h4>Overall Setup (Real)</h4>
                    <p>Real-world UR5 robot setup with third-view depth camera for manipulation tasks</p>
                </div>
                <div class="setup-item-exp">
                    <img src="figs/kitchen-distribution.png" alt="Kitchen task distribution (real)">
                    <h4>Kitchen Task Distribution (Real)</h4>
                    <p>Test distribution following simulation randomization boundaries for real-world experiments</p>
                </div>
                <div class="setup-item-exp">
                    <img src="figs/canteen-distribution.png" alt="Canteen task distribution (real)">
                    <h4>Canteen Task Distribution (Real)</h4>
                    <p>Test distribution following simulation randomization boundaries for real-world experiments</p>
                </div>
            </div>
        </div>
    </section>

    <section id="quantitative-results" class="quantitative-results">
        <div class="container">
            <h2>Quantitative Results</h2>
            
            <div class="table-section">
                <h3>Depth Evaluation on Hammer Dataset (Zero-shot)</h3>
                <div class="table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th rowspan="2">Split</th>
                                <th rowspan="2">Depth Model</th>
                                <th>L1 ↓</th>
                                <th>RMSE ↓</th>
                                <th>AbsRel ↓</th>
                                <th>δ₀.₅ ↑</th>
                                <th>δ₁ ↑</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="header-row">
                                <td rowspan="7">D435<br>(IR Stereo)</td>
                                <td class="best-result"><strong>CDM-D435 (Ours)</strong></td>
                                <td><strong>0.0258</strong></td>
                                <td><strong>0.0404</strong></td>
                                <td><strong>0.0312</strong></td>
                                <td><strong>0.9842</strong></td>
                                <td><strong>0.9951</strong></td>
                            </tr>
                            <tr>
                                <td class="best-result"><strong>CDM-L515 (Ours)</strong></td>
                                <td><strong>0.0182</strong></td>
                                <td><strong>0.0338</strong></td>
                                <td><strong>0.0217</strong></td>
                                <td><strong>0.9877</strong></td>
                                <td><strong>0.9956</strong></td>
                            </tr>
                            <tr>
                                <td>PromptDA*(435)</td>
                                <td>0.0434</td>
                                <td>0.0666</td>
                                <td>0.0599</td>
                                <td>0.9459</td>
                                <td>0.9770</td>
                            </tr>
                            <tr>
                                <td>PromptDA*(515)</td>
                                <td>0.1830</td>
                                <td>0.2387</td>
                                <td>0.2750</td>
                                <td>0.8802</td>
                                <td>0.9186</td>
                            </tr>
                            <tr>
                                <td>PromptDA</td>
                                <td>0.0396</td>
                                <td>0.0691</td>
                                <td>0.0484</td>
                                <td>0.9503</td>
                                <td>0.9772</td>
                            </tr>
                            <tr>
                                <td>PriorDA</td>
                                <td>0.0388</td>
                                <td>0.0754</td>
                                <td>0.0461</td>
                                <td>0.9632</td>
                                <td>0.9880</td>
                            </tr>
                            <tr>
                                <td>Raw Depth</td>
                                <td>0.0550</td>
                                <td>0.1458</td>
                                <td>0.0708</td>
                                <td>0.9179</td>
                                <td>0.9543</td>
                            </tr>
                            
                            <tr class="header-row">
                                <td rowspan="7">L515<br>(D-ToF)</td>
                                <td class="best-result"><strong>CDM-L515 (Ours)</strong></td>
                                <td><strong>0.0156</strong></td>
                                <td><strong>0.0297</strong></td>
                                <td><strong>0.0229</strong></td>
                                <td><strong>0.9754</strong></td>
                                <td><strong>0.9919</strong></td>
                            </tr>
                            <tr>
                                <td class="best-result"><strong>CDM-D435 (Ours)</strong></td>
                                <td><strong>0.0165</strong></td>
                                <td><strong>0.0349</strong></td>
                                <td><strong>0.0246</strong></td>
                                <td><strong>0.9613</strong></td>
                                <td><strong>0.9855</strong></td>
                            </tr>
                            <tr>
                                <td>PromptDA*(515)</td>
                                <td>0.0235</td>
                                <td>0.0666</td>
                                <td>0.0349</td>
                                <td>0.9291</td>
                                <td>0.9730</td>
                            </tr>
                            <tr>
                                <td>PromptDA*(435)</td>
                                <td>0.0254</td>
                                <td>0.0438</td>
                                <td>0.0379</td>
                                <td>0.9234</td>
                                <td>0.9640</td>
                            </tr>
                            <tr>
                                <td>PromptDA</td>
                                <td>0.0207</td>
                                <td>0.0515</td>
                                <td>0.0304</td>
                                <td>0.9480</td>
                                <td>0.9699</td>
                            </tr>
                            <tr>
                                <td>PriorDA</td>
                                <td>0.0177</td>
                                <td>0.0385</td>
                                <td>0.0274</td>
                                <td>0.9502</td>
                                <td>0.9763</td>
                            </tr>
                            <tr>
                                <td>Raw Depth</td>
                                <td>0.0312</td>
                                <td>0.0813</td>
                                <td>0.0475</td>
                                <td>0.9098</td>
                                <td>0.9429</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-section">
                <h3>Sim-to-Real Transfer Results</h3>
                <p>Zero-shot sim-to-real results using CDMs as plugin in real-world robot pipeline</p>
                <div class="table-container">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th rowspan="3">Camera</th>
                                <th rowspan="3">Depth Model</th>
                                <th colspan="4">Kitchen Task</th>
                                <th colspan="6">Canteen Task</th>
                            </tr>
                            <tr>
                                <th>Pick Bowl</th>
                                <th>Put Bowl into Microwave</th>
                                <th>Close Microwave</th>
                                <th>Total</th>
                                <th>Pick Fork</th>
                                <th>Place Fork</th>
                                <th>Pick Plate</th>
                                <th>Dump Plate</th>
                                <th>Place Plate</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td rowspan="5">D435</td><td>None</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                            <tr><td>PromptDA</td><td>11/30</td><td>5/30</td><td>0/30</td><td>0/30</td><td>17/30</td><td>16/30</td><td>7/30</td><td>2/30</td><td>6/30</td><td>1/30</td></tr>
                            <tr><td>PriorDA</td><td>16/30</td><td>8/30</td><td>7/30</td><td>7/30</td><td><strong>30/30</strong></td><td><strong>30/30</strong></td><td>1/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                            <tr class="best-result"><td><strong>CDM-D435</strong></td><td><strong>29/30</strong></td><td><strong>26/30</strong></td><td><strong>26/30</strong></td><td><strong>26/30</strong></td><td><strong>30/30</strong></td><td><strong>30/30</strong></td><td><strong>15/30</strong></td><td><strong>14/30</strong></td><td><strong>14/30</strong></td><td><strong>14/30</strong></td></tr>
                            <tr class="best-result"><td>CDM-L515</td><td><strong>29/30</strong></td><td>22/30</td><td>16/30</td><td>14/30</td><td><strong>30/30</strong></td><td>29/30</td><td>0/30</td><td>0/30</td><td>0/30</td><td>0/30</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="figure-section">
                <h3>Real-World Depth-Only Imitation Learning</h3>
                <div class="imitation-results-grid">
                    <div class="table-item">
                        <div class="imitation-table-container">
                            <table class="imitation-table">
                                <thead>
                                    <tr>
                                        <th rowspan="3">Depth Model</th>
                                        <th colspan="2">Toothpaste-and-Cup</th>
                                        <th colspan="2">Stack-Bowls</th>
                                    </tr>
                                    <tr>
                                        <th>Pick Toothpaste</th>
                                        <th>Put Toothpaste into Cup</th>
                                        <th>Pick Bowl</th>
                                        <th>Stack Bowl</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>None</td>
                                        <td>0/15</td>
                                        <td>0/15</td>
                                        <td>6/15</td>
                                        <td>3/15</td>
                                    </tr>
                                    <tr class="best-result">
                                        <td><strong>CDM-D435</strong></td>
                                        <td><strong>10/15</strong></td>
                                        <td><strong>6/15</strong></td>
                                        <td><strong>11/15</strong></td>
                                        <td><strong>9/15</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <h4>Results w/w.o CDM</h4>
                        <p>50 demonstrations for each task, collected by teleoperation</p>
                    </div>
                    <div class="figure-item">
                        <h4>Generalization Over Different Object Sizes</h4>
                        <p>The policy trained without CDM cannot generalize to unseen sizes, while CDM-enhanced policies show better generalization.</p>
                        <img src="figs/success-rate-hist.png" alt="Success Rate Histogram">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="method">
        <div class="container">
            <h2>Method Overview</h2>
            <div class="method-grid">
                <div class="method-item">
                    <img src="figs/camera_depth_model.png" alt="Camera Depth Model">
                    <h3>Camera Depth Models (CDMs)</h3>
                    <p>CDMs process RGB images and noisy depth signals from specific depth cameras to produce high-quality, denoised metric depth.</p>
                </div>
                <div class="method-item">
                    <img src="figs/noise-model.png" alt="Noise Model">
                    <h3>Neural Data Engine</h3>
                    <p>We model depth camera noise patterns to generate high-quality paired data from simulation for training CDMs.</p>
                </div>
            </div>
        </div>
    </section>


    <section class="citation">
        <div class="container">
            <h2>Citation</h2>
            <pre><code>@article{liu2024manipulation,
  title={Manipulation as in Simulation: Enabling Accurate Geometry Perception in Robots},
  author={Liu, Minghuan and Zhu, Zhengbang and Han, Xiaoshen and Hu, Peng and Lin, Haotong and 
          Li, Xinyao and Chen, Jingxiao and Xu, Jiafeng and Yang, Yichu and Lin, Yunfeng and 
          Li, Xinghang and Yu, Yong and Zhang, Weinan and Kong, Tao and Kang, Bingyi},
  journal={arXiv preprint},
  year={2024}
}</code></pre>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>© 2024 ByteDance Seed. All rights reserved.</p>
            <p>Correspondence: <a href="mailto:ericliuof97@gmail.com">Minghuan Liu</a>, <a href="mailto:bingyikang@bytedance.com">Bingyi Kang</a></p>
        </div>
    </footer>

    <script>
        // Point Cloud Scene and Camera Selector
        document.addEventListener('DOMContentLoaded', function() {
            const sceneButtons = document.querySelectorAll('#scene-selector .selector-btn');
            const cameraButtons = document.querySelectorAll('#camera-selector .selector-btn');
            const modelAButtons = document.querySelectorAll('#model-a-selector .selector-btn');
            const modelBButtons = document.querySelectorAll('#model-b-selector .selector-btn');
            const pcdGroups = document.querySelectorAll('.pcd-scene-camera-group');
            
            // Flag to track if this is the initial page load
            let isInitialLoad = true;
            
            // Model path mapping
            const modelPathMap = {
                'kitchen': {
                    '435': {
                        '435': 'pcds/microwave_435_model_435_depth.ply',
                        '515': 'pcds/microwave_435_model_515_depth.ply', 
                        'priorda': 'pcds/microwave_435_model_priorda_depth.ply'
                    },
                    '515': {
                        '435': 'pcds/microwave_515_model_435_depth.ply',
                        '515': 'pcds/microwave_515_model_depth.ply',
                        'priorda': 'pcds/microwave_515_model_priorda_depth.ply'
                    }
                },
                'canteen': {
                    '435': {
                        '435': 'pcds/canteen_435_model_435_depth.ply',
                        '515': 'pcds/canteen_435_model_515_depth.ply',
                        'priorda': 'pcds/canteen_435_model_priorda_depth.ply'
                    },
                    '515': {
                        '435': 'pcds/canteen_515_model_435_depth.ply',
                        '515': 'pcds/canteen_515_model_515_depth.ply',
                        'priorda': 'pcds/canteen_515_model_priorda_depth.ply'
                    }
                },
                'stackbowl': {
                    '435': {
                        '435': 'pcds/stackbowl_435_model_435_depth.ply',
                        '515': 'pcds/stackbowl_435_model_515_depth.ply',
                        'priorda': 'pcds/stackbowl_435_model_priorda_depth.ply'
                    }
                },
                'toothpaste': {
                    '435': {
                        '435': 'pcds/toothpaste_435_model_435_depth.ply',
                        '515': 'pcds/toothpaste_435_model_515_depth.ply',
                        'priorda': 'pcds/toothpaste_435_model_priorda_depth.ply'
                    }
                }
            };
            
            // Model display names
            const modelNames = {
                '435': 'CDM-D435',
                '515': 'CDM-L515',
                'priorda': 'PriorDA'
            };
            
            function updatePointCloudDisplay() {
                // Get active selections
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active').dataset.camera;
                const activeModelA = document.querySelector('#model-a-selector .selector-btn.active').dataset.model;
                const activeModelB = document.querySelector('#model-b-selector .selector-btn.active').dataset.model;
                
                // Before hiding groups, dispose any active viewers in the groups being hidden
                pcdGroups.forEach(group => {
                    // If this group is currently visible and will be hidden
                    if (group.style.display !== 'none' && 
                        (group.dataset.scene !== activeScene || group.dataset.camera !== activeCamera)) {
                        // Find all loaded viewers in this group
                        const containers = group.querySelectorAll('.pcd-lazy-container');
                        containers.forEach(container => {
                            const viewerId = container.dataset.viewerId;
                            // Check if viewer exists in global loadedViewers object
                            if (window.loadedViewers && window.loadedViewers[viewerId]) {
                                // Dispose the viewer
                                if (window.loadedViewers[viewerId].dispose) {
                                    window.loadedViewers[viewerId].dispose();
                                }
                                delete window.loadedViewers[viewerId];
                                
                                // Reset the container to show placeholder
                                const placeholder = container.querySelector('.pcd-placeholder');
                                const button = container.querySelector('.load-interactive-btn');
                                const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                                
                                if (placeholder) placeholder.style.display = 'block';
                                if (button) button.style.display = 'block';
                                if (viewerDiv) viewerDiv.style.display = 'none';
                            }
                        });
                    }
                    group.style.display = 'none';
                });
                
                // Show the selected group
                const selectedGroup = document.querySelector(`.pcd-scene-camera-group[data-scene="${activeScene}"][data-camera="${activeCamera}"]`);
                if (selectedGroup) {
                    selectedGroup.style.display = 'block';
                    
                    // Only update if not initial load OR if models have changed
                    if (!isInitialLoad) {
                        // Update Model A viewer
                        const modelAViewer = selectedGroup.querySelector('.model-a-viewer');
                        if (modelAViewer) {
                            const modelAContainer = modelAViewer.querySelector('.pcd-lazy-container');
                            const modelALabel = modelAViewer.querySelector('p');
                            
                            if (modelPathMap[activeScene] && 
                                modelPathMap[activeScene][activeCamera] && 
                                modelPathMap[activeScene][activeCamera][activeModelA]) {
                                
                                const newPath = modelPathMap[activeScene][activeCamera][activeModelA];
                                const viewerId = modelAContainer.dataset.viewerId;
                                const currentPath = modelAContainer.dataset.plyPath;
                                
                                // Only update if path actually changed
                                if (currentPath !== newPath) {
                                    // Update the data attribute
                                    modelAContainer.dataset.plyPath = newPath;
                                    
                                    // Update label
                                    modelALabel.textContent = `Model A: ${modelNames[activeModelA]}`;
                                    
                                    // Update placeholder image
                                    const placeholder = modelAContainer.querySelector('.pcd-placeholder');
                                    const button = modelAContainer.querySelector('.load-interactive-btn');
                                    const viewerDiv = modelAContainer.querySelector('.pcd-viewer-optimized');
                                    
                                    if (placeholder) {
                                        const imagePath = newPath.replace('pcds/', 'screenshots/').replace('.ply', '.png');
                                        placeholder.src = imagePath;
                                    }
                                    
                                    // If a viewer is currently loaded, dispose it and reset
                                    if (window.loadedViewers[viewerId]) {
                                        if (window.loadedViewers[viewerId].dispose) {
                                            window.loadedViewers[viewerId].dispose();
                                        }
                                        delete window.loadedViewers[viewerId];
                                        
                                        // Reset to show placeholder and button
                                        if (placeholder) placeholder.style.display = 'block';
                                        if (button) button.style.display = 'block';
                                        if (viewerDiv) viewerDiv.style.display = 'none';
                                    }
                                }
                            }
                        }
                        
                        // Update Model B viewer
                        const modelBViewer = selectedGroup.querySelector('.model-b-viewer');
                        if (modelBViewer) {
                            const modelBContainer = modelBViewer.querySelector('.pcd-lazy-container');
                            const modelBLabel = modelBViewer.querySelector('p');
                            
                            if (modelPathMap[activeScene] && 
                                modelPathMap[activeScene][activeCamera] && 
                                modelPathMap[activeScene][activeCamera][activeModelB]) {
                                
                                const newPath = modelPathMap[activeScene][activeCamera][activeModelB];
                                const viewerId = modelBContainer.dataset.viewerId;
                                const currentPath = modelBContainer.dataset.plyPath;
                                
                                // Only update if path actually changed
                                if (currentPath !== newPath) {
                                    // Update the data attribute
                                    modelBContainer.dataset.plyPath = newPath;
                                    
                                    // Update label
                                    modelBLabel.textContent = `Model B: ${modelNames[activeModelB]}`;
                                    
                                    // Update placeholder image
                                    const placeholder = modelBContainer.querySelector('.pcd-placeholder');
                                    const button = modelBContainer.querySelector('.load-interactive-btn');
                                    const viewerDiv = modelBContainer.querySelector('.pcd-viewer-optimized');
                                    
                                    if (placeholder) {
                                        const imagePath = newPath.replace('pcds/', 'screenshots/').replace('.ply', '.png');
                                        placeholder.src = imagePath;
                                    }
                                    
                                    // If a viewer is currently loaded, dispose it and reset
                                    if (window.loadedViewers[viewerId]) {
                                        if (window.loadedViewers[viewerId].dispose) {
                                            window.loadedViewers[viewerId].dispose();
                                        }
                                        delete window.loadedViewers[viewerId];
                                        
                                        // Reset to show placeholder and button
                                        if (placeholder) placeholder.style.display = 'block';
                                        if (button) button.style.display = 'block';
                                        if (viewerDiv) viewerDiv.style.display = 'none';
                                    }
                                }
                            }
                        }
                    }
                    
                    // After first call, no longer initial load
                    if (isInitialLoad) {
                        isInitialLoad = false;
                    }
                }
            }
            
            function updateCameraAvailability() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const l515Button = document.querySelector('#camera-selector .selector-btn[data-camera="515"]');
                const d435Button = document.querySelector('#camera-selector .selector-btn[data-camera="435"]');
                
                // Disable L515 for Stack Bowl and Place Toothpaste scenes
                if (activeScene === 'stackbowl' || activeScene === 'toothpaste') {
                    l515Button.disabled = true;
                    l515Button.style.opacity = '0.5';
                    l515Button.style.cursor = 'not-allowed';
                    
                    // If L515 is currently selected, switch to D435
                    if (l515Button.classList.contains('active')) {
                        l515Button.classList.remove('active');
                        d435Button.classList.add('active');
                    }
                } else {
                    l515Button.disabled = false;
                    l515Button.style.opacity = '1';
                    l515Button.style.cursor = 'pointer';
                }
            }
            
            function updateSceneAvailability() {
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active').dataset.camera;
                const stackBowlButton = document.querySelector('#scene-selector .selector-btn[data-scene="stackbowl"]');
                const toothpasteButton = document.querySelector('#scene-selector .selector-btn[data-scene="toothpaste"]');
                const kitchenButton = document.querySelector('#scene-selector .selector-btn[data-scene="kitchen"]');
                const canteenButton = document.querySelector('#scene-selector .selector-btn[data-scene="canteen"]');
                
                // Disable Stack Bowl and Place Toothpaste scenes when L515 is selected
                if (activeCamera === '515') {
                    stackBowlButton.disabled = true;
                    stackBowlButton.style.opacity = '0.5';
                    stackBowlButton.style.cursor = 'not-allowed';
                    
                    toothpasteButton.disabled = true;
                    toothpasteButton.style.opacity = '0.5';
                    toothpasteButton.style.cursor = 'not-allowed';
                    
                    // If Stack Bowl or Toothpaste is currently selected, switch to Kitchen
                    const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                    if (activeScene === 'stackbowl' || activeScene === 'toothpaste') {
                        document.querySelector('#scene-selector .selector-btn.active').classList.remove('active');
                        kitchenButton.classList.add('active');
                    }
                } else {
                    stackBowlButton.disabled = false;
                    stackBowlButton.style.opacity = '1';
                    stackBowlButton.style.cursor = 'pointer';
                    
                    toothpasteButton.disabled = false;
                    toothpasteButton.style.opacity = '1';
                    toothpasteButton.style.cursor = 'pointer';
                }
            }
            
            function updateModelAvailability() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active').dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active')?.dataset.camera;
                
                // Get all model buttons
                const modelA515 = document.querySelector('#model-a-selector .selector-btn[data-model="515"]');
                const modelAPriorDA = document.querySelector('#model-a-selector .selector-btn[data-model="priorda"]');
                const modelA435 = document.querySelector('#model-a-selector .selector-btn[data-model="435"]');
                
                const modelB515 = document.querySelector('#model-b-selector .selector-btn[data-model="515"]');
                const modelBPriorDA = document.querySelector('#model-b-selector .selector-btn[data-model="priorda"]');
                const modelB435 = document.querySelector('#model-b-selector .selector-btn[data-model="435"]');
                
                // Enable all models for all scenes now that stackbowl and toothpaste have all models
                [modelA515, modelAPriorDA, modelA435, modelB515, modelBPriorDA, modelB435].forEach(btn => {
                    if (btn) {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                    }
                });
            }
            
            // Add click handlers for scene buttons
            sceneButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    sceneButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateCameraAvailability();
                    updateModelAvailability();
                    updatePointCloudDisplay();
                    // Update debug info if in debug mode
                    if (typeof updateDebugSceneInfo === 'function') {
                        updateDebugSceneInfo();
                    }
                });
            });
            
            // Add click handlers for camera buttons
            cameraButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    cameraButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateSceneAvailability();
                    updateModelAvailability();
                    updatePointCloudDisplay();
                    // Update debug info if in debug mode
                    if (typeof updateDebugSceneInfo === 'function') {
                        updateDebugSceneInfo();
                    }
                });
            });
            
            // Add click handlers for Model A buttons
            modelAButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    modelAButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updatePointCloudDisplay();
                });
            });
            
            // Add click handlers for Model B buttons
            modelBButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Don't do anything if button is disabled
                    if (this.disabled) return;
                    
                    modelBButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updatePointCloudDisplay();
                });
            });
            
            // Initialize display
            updateCameraAvailability();
            updateSceneAvailability();
            updateModelAvailability();
            updatePointCloudDisplay();
            
            // Function to update debug scene info
            function updateDebugSceneInfo() {
                const activeScene = document.querySelector('#scene-selector .selector-btn.active')?.dataset.scene;
                const activeCamera = document.querySelector('#camera-selector .selector-btn.active')?.dataset.camera;
                
                const sceneElement = document.getElementById('debug-scene');
                const cameraElement = document.getElementById('debug-camera');
                
                if (sceneElement) {
                    sceneElement.textContent = activeScene ? activeScene.charAt(0).toUpperCase() + activeScene.slice(1) : '-';
                }
                if (cameraElement) {
                    cameraElement.textContent = activeCamera ? `D${activeCamera}` : '-';
                }
            }
            
            // Depth Accuracy Dataset Selector
            const datasetButtons = document.querySelectorAll('#dataset-selector .selector-btn');
            const datasetGroups = document.querySelectorAll('.accuracy-dataset-group');
            
            function updateAccuracyDisplay() {
                // Get active dataset
                const activeDataset = document.querySelector('#dataset-selector .selector-btn.active')?.dataset.dataset;
                
                if (!activeDataset) return;
                
                // Hide all groups
                datasetGroups.forEach(group => {
                    group.style.display = 'none';
                });
                
                // Show the selected group
                const selectedGroup = document.querySelector(`.accuracy-dataset-group[data-dataset="${activeDataset}"]`);
                if (selectedGroup) {
                    selectedGroup.style.display = 'block';
                    
                    // Trigger chart redraw if needed (Chart.js specific)
                    const charts = selectedGroup.querySelectorAll('canvas');
                    charts.forEach(canvas => {
                        const chartInstance = Chart.getChart(canvas.id);
                        if (chartInstance) {
                            chartInstance.resize();
                        }
                    });
                }
            }
            
            // Add click handlers for dataset buttons
            datasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    datasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateAccuracyDisplay();
                });
            });
            
            // Initialize accuracy display
            updateAccuracyDisplay();
            
            // ByteDepth Dataset Image Selector
            const cameraDatasetButtons = document.querySelectorAll('#camera-dataset-selector .selector-btn');
            const sceneDatasetButtons = document.querySelectorAll('#scene-dataset-selector .selector-btn');
            const rgbImage = document.getElementById('dataset-rgb-image');
            const depthImage = document.getElementById('dataset-depth-image');
            
            // Camera folder mappings
            const cameraFolderMap = {
                'd435': 'camera_d435',
                'd415': 'camera_d415',
                'd455': 'camera_d455',
                'd405': 'camera_d405',
                'l515': 'camera_l515',
                'kinect': 'camera_kinect',
                'zed2i_neural': 'camera_zed2i_neural',
                'zed2i_ultra': 'camera_zed2i_ultra',
                'zed2i_quality': 'camera_zed2i_quality',
                'zed2i_performance': 'camera_zed2i_performance'
            };
            
            // Scene file mappings (note: "kichen" is spelled that way in the files)
            const sceneFileMap = {
                'living': 'living',
                'kichen': 'kichen',
                'bedroom': 'bedroom',
                'bathroom': 'bathroom',
                'office': 'office',
                'market': 'market',
                'break_room': 'Break Room'
            };
            
            function updateDatasetImages() {
                const activeCamera = document.querySelector('#camera-dataset-selector .selector-btn.active')?.dataset.camera;
                const activeScene = document.querySelector('#scene-dataset-selector .selector-btn.active')?.dataset.scene;
                
                if (!activeCamera || !activeScene) return;
                
                const cameraFolder = cameraFolderMap[activeCamera];
                const sceneFile = sceneFileMap[activeScene];
                
                if (cameraFolder && sceneFile) {
                    const basePath = `figs/rgb_depth/${cameraFolder}/`;
                    rgbImage.src = `${basePath}${sceneFile}_rgb.png`;
                    depthImage.src = `${basePath}${sceneFile}_depth.png`;
                    
                    // Add fade effect
                    rgbImage.style.opacity = '0';
                    depthImage.style.opacity = '0';
                    
                    setTimeout(() => {
                        rgbImage.style.opacity = '1';
                        depthImage.style.opacity = '1';
                    }, 50);
                }
            }
            
            // Add click handlers for camera dataset buttons
            cameraDatasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    cameraDatasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDatasetImages();
                });
            });
            
            // Add click handlers for scene dataset buttons
            sceneDatasetButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    sceneDatasetButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDatasetImages();
                });
            });
            
            // Initialize dataset images
            updateDatasetImages();
        });
        
        // Optimized Point Cloud Viewer for 90k+ points
        class OptimizedPointCloudViewer {
            constructor(containerId, plyPath, isL515 = false, captureMode = false, debugMode = false) {
                this.container = document.getElementById(containerId);
                this.plyPath = plyPath;
                this.currentLOD = null;
                this.isLoading = true;
                this.isL515 = isL515; // Flag to use different camera settings for L515
                this.captureMode = captureMode; // Flag for screenshot capture mode
                this.debugMode = debugMode; // Flag for debug mode
                this.viewerId = containerId; // Store viewer ID for tracking
                
                // Point cloud visualization settings
                this.pointSize = 0.02; // Adjust this value to change point size
                
                this.init();
            }
            
            captureScreenshot() {
                // Force update controls
                this.controls.update();
                
                // Ensure the scene is rendered one more time
                this.renderer.render(this.scene, this.camera);
                
                // Get the canvas
                const canvas = this.renderer.domElement;
                
                // Check if canvas has content
                if (canvas.width === 0 || canvas.height === 0) {
                    console.error('Canvas has no dimensions');
                    return null;
                }
                
                // Capture the canvas as data URL with preserveDrawingBuffer
                const dataURL = canvas.toDataURL('image/png', 1.0);
                
                // Extract filename from ply path
                const filename = this.plyPath.split('/').pop().replace('.ply', '.png');
                
                if (this.captureMode) {
                    // Check if the image is not empty
                    if (dataURL && dataURL.length > 100) {
                        // Auto-download in capture mode
                        const link = document.createElement('a');
                        link.download = filename;
                        link.href = dataURL;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log(`Screenshot captured: ${filename} (${dataURL.length} bytes)`);
                    } else {
                        console.error(`Failed to capture screenshot for ${filename}`);
                    }
                }
                
                return dataURL;
            }

            init() {
                if (!this.container) return;

                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf5f5f5);

                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    45,
                    this.container.clientWidth / this.container.clientHeight,
                    0.1,
                    1000
                );
                
                // Set camera position based on camera type
                if (this.isL515) {
                    // L515 camera position
                    this.camera.position.set(0.278, 1.856, 1.286);
                } else {
                    // D435 camera position (updated)
                    this.camera.position.set(-0.169, 1.908, 1.173);
                }
                
                // Set the up vector to ensure correct orientation
                this.camera.up.set(0, 1, 0);

                // Optimized renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: false, // Disable for better performance
                    powerPreference: "high-performance",
                    preserveDrawingBuffer: true // Required for screenshot capture
                });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5)); // Limit pixel ratio
                this.container.appendChild(this.renderer.domElement);

                // Controls with free rotation
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 0.5;
                this.controls.maxDistance = 10;
                
                // Set target based on camera type
                if (this.isL515) {
                    // L515 target
                    this.controls.target.set(-0.002, -0.351, 0.113);
                } else {
                    // D435 target (updated)
                    this.controls.target.set(-0.107, -0.351, 0.068);
                }
                this.controls.update();

                // Simple lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
                this.scene.add(ambientLight);

                // Load point cloud with LOD
                this.loadPointCloud();

                // Start render loop
                this.animate();

                // Handle resize
                window.addEventListener('resize', () => this.handleResize());
            }

            loadPointCloud() {
                const loadingDiv = this.container.querySelector('.pcd-loading');
                if (loadingDiv) {
                    loadingDiv.textContent = 'Loading point cloud...';
                }

                const loader = new THREE.PLYLoader();
                
                loader.load(
                    this.plyPath,
                    (geometry) => this.onGeometryLoaded(geometry),
                    (xhr) => {
                        if (xhr.lengthComputable && loadingDiv) {
                            const percentComplete = (xhr.loaded / xhr.total) * 100;
                            loadingDiv.textContent = `Loading: ${Math.round(percentComplete)}%`;
                        }
                    },
                    (error) => {
                        console.error('Error loading PLY:', error);
                        if (loadingDiv) {
                            loadingDiv.textContent = 'Failed to load. Please run a local server.';
                        }
                    }
                );
            }

            onGeometryLoaded(geometry) {
                const loadingDiv = this.container.querySelector('.pcd-loading');
                if (loadingDiv) {
                    loadingDiv.style.display = 'none';
                }

                // Convert from Blender's Z-up to Three.js Y-up coordinate system
                // Rotate -90 degrees around X axis to swap Y and Z
                geometry.rotateX(-Math.PI / 2);

                // Center and scale
                geometry.computeBoundingBox();
                geometry.center();
                const size = new THREE.Vector3();
                geometry.boundingBox.getSize(size);
                const scale = 2 / Math.max(size.x, size.y, size.z);
                geometry.scale(scale, scale, scale);

                // Create point cloud with all points (highest quality)
                this.currentLOD = this.createPointCloud(geometry, 1.0);
                this.scene.add(this.currentLOD);
                
                this.isLoading = false;
                
                // Capture screenshot if in capture mode
                if (this.captureMode) {
                    console.log(`Point cloud loaded for ${this.plyPath}, preparing to capture...`);
                    // Need to wait for several animation frames to ensure proper rendering
                    let frameCount = 0;
                    const captureAfterFrames = () => {
                        frameCount++;
                        if (frameCount < 10) {
                            // Ensure we render a few frames first
                            this.renderer.render(this.scene, this.camera);
                            requestAnimationFrame(captureAfterFrames);
                        } else {
                            // Now capture the screenshot
                            console.log(`Capturing screenshot for ${this.plyPath}...`);
                            this.captureScreenshot();
                        }
                    };
                    requestAnimationFrame(captureAfterFrames);
                }
            }


            createPointCloud(geometry, pointSize) {
                // Add colors if not present
                if (!geometry.attributes.color) {
                    const positions = geometry.attributes.position.array;
                    const pointCount = positions.length / 3;
                    const colors = new Float32Array(pointCount * 3);
                    
                    for (let i = 0; i < pointCount; i++) {
                        const y = positions[i * 3 + 1];
                        const t = (y + 1) * 0.5;
                        colors[i * 3] = 0.1 + t * 0.3;
                        colors[i * 3 + 1] = 0.4 + t * 0.4;
                        colors[i * 3 + 2] = 0.8;
                    }
                    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                }

                const material = new THREE.PointsMaterial({
                    size: this.pointSize,
                    vertexColors: true,
                    sizeAttenuation: true
                });

                return new THREE.Points(geometry, material);
            }

            animate() {
                this.animationId = requestAnimationFrame(() => this.animate());

                // Always render for smooth interaction
                this.renderer.render(this.scene, this.camera);
                
                // Update camera info display in debug mode
                if (this.debugMode) {
                    this.updateCameraInfo();
                }
            }
            
            updateCameraInfo() {
                const pos = this.camera.position;
                const target = this.controls.target;
                
                // Determine which viewer this is based on the viewer ID
                const isRawViewer = this.viewerId.includes('raw');
                const isModelViewer = this.viewerId.includes('model');
                
                if (isRawViewer) {
                    // Update left viewer (raw depth) info
                    const posElement = document.getElementById('debug-left-pos');
                    const targetElement = document.getElementById('debug-left-target');
                    
                    if (posElement) {
                        posElement.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (targetElement) {
                        targetElement.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                } else if (isModelViewer) {
                    // Update right viewer (CDM output) info
                    const posElement = document.getElementById('debug-right-pos');
                    const targetElement = document.getElementById('debug-right-target');
                    
                    if (posElement) {
                        posElement.textContent = `(${pos.x.toFixed(3)}, ${pos.y.toFixed(3)}, ${pos.z.toFixed(3)})`;
                    }
                    if (targetElement) {
                        targetElement.textContent = `(${target.x.toFixed(3)}, ${target.y.toFixed(3)}, ${target.z.toFixed(3)})`;
                    }
                }
            }

            handleResize() {
                this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            }
            
            dispose() {
                // Cancel animation frame
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                
                // Dispose of Three.js resources
                if (this.currentLOD) {
                    if (this.currentLOD.geometry) {
                        this.currentLOD.geometry.dispose();
                    }
                    if (this.currentLOD.material) {
                        this.currentLOD.material.dispose();
                    }
                }
                
                // Dispose of renderer
                if (this.renderer) {
                    this.renderer.dispose();
                    if (this.renderer.domElement && this.renderer.domElement.parentNode) {
                        this.renderer.domElement.parentNode.removeChild(this.renderer.domElement);
                    }
                }
                
                // Dispose of controls
                if (this.controls) {
                    this.controls.dispose();
                }
                
                // Remove resize event listener
                window.removeEventListener('resize', () => this.handleResize());
                
                // Clear the container
                if (this.container) {
                    while (this.container.firstChild) {
                        this.container.removeChild(this.container.firstChild);
                    }
                    // Re-add the loading div for potential future use
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'pcd-loading';
                    loadingDiv.textContent = 'Initializing viewer...';
                    this.container.appendChild(loadingDiv);
                }
            }
        }

        // Initialize viewers when page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Check URL parameters for capture mode and debug mode
            const urlParams = new URLSearchParams(window.location.search);
            const captureMode = urlParams.get('capture') === 'true';
            const debugMode = urlParams.get('debug') === 'true';
            
            // Show debug panel if in debug mode
            if (debugMode) {
                const debugPanel = document.getElementById('debug-panel');
                if (debugPanel) {
                    debugPanel.style.display = 'block';
                }
            }
            
            // Check if running locally
            const isLocal = window.location.protocol === 'file:';
            
            if (isLocal && !captureMode) {
                document.querySelectorAll('.pcd-loading').forEach(div => {
                    div.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <p>To view interactive point clouds:</p>
                            <p style="font-size: 12px;">Run: <code>python3 -m http.server 8000</code></p>
                            <p style="font-size: 12px;">Visit: <code>http://localhost:8000</code></p>
                        </div>
                    `;
                });
                // Still set up lazy loading for local mode
            }
            
            // Track loaded viewers (make it global for access from other functions)
            window.loadedViewers = window.loadedViewers || {};
            
            // Function to load a viewer on demand
            function loadViewer(container) {
                const viewerId = container.dataset.viewerId;
                const plyPath = container.dataset.plyPath;
                const isL515 = container.dataset.isL515 === 'true';
                
                // Prevent duplicate loading
                if (window.loadedViewers[viewerId]) return;
                
                // Hide placeholder and button
                const placeholder = container.querySelector('.pcd-placeholder');
                const button = container.querySelector('.load-interactive-btn');
                const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                
                if (placeholder) placeholder.style.display = 'none';
                if (button) button.style.display = 'none';
                if (viewerDiv) viewerDiv.style.display = 'block';
                
                // Create the viewer with debug mode
                window.loadedViewers[viewerId] = new OptimizedPointCloudViewer(viewerId, plyPath, isL515, false, debugMode);
                
                // Update debug info with current scene and camera
                if (debugMode) {
                    updateDebugSceneInfo();
                }
            }
            
            // Set up lazy loading buttons
            document.querySelectorAll('.load-interactive-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const container = this.closest('.pcd-lazy-container');
                    if (container) {
                        loadViewer(container);
                    }
                });
            });
            
            // If in capture mode, load all viewers immediately to capture screenshots
            if (captureMode) {
                console.log('Screenshot capture mode enabled');
                alert('Screenshot capture mode enabled. The page will automatically download screenshots of all point clouds.');
                
                // First, make ALL scene-camera groups visible so all viewers can be loaded
                document.querySelectorAll('.pcd-scene-camera-group').forEach(group => {
                    group.style.display = 'block';
                });
                
                // Then make all viewer containers visible
                document.querySelectorAll('.pcd-lazy-container').forEach(container => {
                    const placeholder = container.querySelector('.pcd-placeholder');
                    const button = container.querySelector('.load-interactive-btn');
                    const viewerDiv = container.querySelector('.pcd-viewer-optimized');
                    
                    if (placeholder) placeholder.style.display = 'none';
                    if (button) button.style.display = 'none';
                    if (viewerDiv) viewerDiv.style.display = 'block';
                });
                
                // Create a hidden container for capture mode viewers
                const captureContainer = document.createElement('div');
                captureContainer.id = 'capture-container';
                captureContainer.style.position = 'absolute';
                captureContainer.style.left = '-9999px';
                captureContainer.style.width = '800px';
                captureContainer.style.height = '600px';
                document.body.appendChild(captureContainer);
                
                // Load all viewers with capture mode enabled
                // Note: Using setTimeout to stagger the loading slightly to prevent browser overload
                const viewerConfigs = [
                    // Kitchen (microwave) scenes
                    { id: 'capture-microwave-435-raw', path: 'pcds/microwave_435_raw_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-435', path: 'pcds/microwave_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-515', path: 'pcds/microwave_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-microwave-435-model-priorda', path: 'pcds/microwave_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-microwave-515-raw', path: 'pcds/microwave_515_raw_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-435', path: 'pcds/microwave_515_model_435_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-515', path: 'pcds/microwave_515_model_515_depth.ply', isL515: true },
                    { id: 'capture-microwave-515-model-priorda', path: 'pcds/microwave_515_model_priorda_depth.ply', isL515: true },
                    
                    // Canteen scenes
                    { id: 'capture-canteen-435-raw', path: 'pcds/canteen_435_raw_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-435', path: 'pcds/canteen_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-515', path: 'pcds/canteen_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-canteen-435-model-priorda', path: 'pcds/canteen_435_model_priorda_depth.ply', isL515: false },
                    { id: 'capture-canteen-515-raw', path: 'pcds/canteen_515_raw_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-435', path: 'pcds/canteen_515_model_435_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-515', path: 'pcds/canteen_515_model_515_depth.ply', isL515: true },
                    { id: 'capture-canteen-515-model-priorda', path: 'pcds/canteen_515_model_priorda_depth.ply', isL515: true },
                    
                    // Stack Bowl scenes
                    { id: 'capture-stackbowl-435-raw', path: 'pcds/stackbowl_435_raw_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-435', path: 'pcds/stackbowl_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-515', path: 'pcds/stackbowl_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-stackbowl-435-model-priorda', path: 'pcds/stackbowl_435_model_priorda_depth.ply', isL515: false },
                    
                    // Toothpaste scenes
                    { id: 'capture-toothpaste-435-raw', path: 'pcds/toothpaste_435_raw_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-435', path: 'pcds/toothpaste_435_model_435_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-515', path: 'pcds/toothpaste_435_model_515_depth.ply', isL515: false },
                    { id: 'capture-toothpaste-435-model-priorda', path: 'pcds/toothpaste_435_model_priorda_depth.ply', isL515: false }
                ];
                
                // Create viewer divs and load all viewers
                viewerConfigs.forEach((config, index) => {
                    // Create a div for each viewer
                    const viewerDiv = document.createElement('div');
                    viewerDiv.id = config.id;
                    viewerDiv.style.width = '800px';
                    viewerDiv.style.height = '600px';
                    captureContainer.appendChild(viewerDiv);
                    
                    // Stagger loading by 200ms each to prevent browser overload
                    setTimeout(() => {
                        console.log(`Loading viewer ${index + 1}/${viewerConfigs.length}: ${config.path}`);
                        new OptimizedPointCloudViewer(config.id, config.path, config.isL515, true);
                    }, index * 200);
                });
            }
            
            // Camera tracking - uncomment to track a specific viewer
            // window.trackedViewer = viewer3; // Track L515 viewer (microwave_515_raw)
            
            // Initialize charts after Chart.js and depth-charts.js are loaded
            if (typeof Chart !== 'undefined' && typeof initDepthAccuracyCharts !== 'undefined') {
                initDepthAccuracyCharts();
            } else {
                // Wait for scripts to load
                const checkScripts = setInterval(() => {
                    if (typeof Chart !== 'undefined' && typeof initDepthAccuracyCharts !== 'undefined') {
                        clearInterval(checkScripts);
                        initDepthAccuracyCharts();
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>
